"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([[5676],{56710:(e,t,a)=>{a.d(t,{Z:()=>s});a(57627);const s=(0,a(97787).Z)({resolved:{},chunkName:()=>"AuthDialog.component.async",isReady(e){const t=this.resolve(e);return!0===this.resolved[t]&&!!a.m[t]},importAsync:()=>Promise.all([a.e(6122),a.e(3332),a.e(8946)]).then(a.bind(a,38585)),requireAsync(e){const t=this.resolve(e);return this.resolved[t]=!1,this.importAsync(e).then(e=>(this.resolved[t]=!0,e))},requireSync(e){const t=this.resolve(e);return a(t)},resolve:()=>38585},{ssr:!1})},6682:(e,t,a)=>{a.d(t,{P:()=>s});a(57627);const s=(0,a(97787).Z)({resolved:{},chunkName:()=>"DisableAdvModal.component.async",isReady(e){const t=this.resolve(e);return!0===this.resolved[t]&&!!a.m[t]},importAsync:()=>Promise.all([a.e(6122),a.e(3332),a.e(7269)]).then(a.bind(a,11308)),requireAsync(e){const t=this.resolve(e);return this.resolved[t]=!1,this.importAsync(e).then(e=>(this.resolved[t]=!0,e))},requireSync(e){const t=this.resolve(e);return a(t)},resolve:()=>11308},{resolveComponent:e=>e.DisableAdvModal})},8855:(e,t,a)=>{a.d(t,{J:()=>s});a(57627);const s=(0,a(97787).Z)({resolved:{},chunkName:()=>"Gifts.component.async",isReady(e){const t=this.resolve(e);return!0===this.resolved[t]&&!!a.m[t]},importAsync:()=>Promise.all([a.e(6122),a.e(3332),a.e(800)]).then(a.bind(a,85320)),requireAsync(e){const t=this.resolve(e);return this.resolved[t]=!1,this.importAsync(e).then(e=>(this.resolved[t]=!0,e))},requireSync(e){const t=this.resolve(e);return a(t)},resolve:()=>85320},{resolveComponent:e=>e.Gifts})},59542:(e,t,a)=>{a.d(t,{Z:()=>s});a(57627);const s=(0,a(97787).Z)({resolved:{},chunkName:()=>"PassportRegistrationChecker.component.async",isReady(e){const t=this.resolve(e);return!0===this.resolved[t]&&!!a.m[t]},importAsync:()=>a.e(6952).then(a.bind(a,23749)),requireAsync(e){const t=this.resolve(e);return this.resolved[t]=!1,this.importAsync(e).then(e=>(this.resolved[t]=!0,e))},requireSync(e){const t=this.resolve(e);return a(t)},resolve:()=>23749},{ssr:!1})},95662:(e,t,a)=>{a.d(t,{Z:()=>s});a(57627);const s=(0,a(97787).Z)({resolved:{},chunkName:()=>"PlayGameHeaderMenu.component.async",isReady(e){const t=this.resolve(e);return!0===this.resolved[t]&&!!a.m[t]},importAsync:()=>a.e(4932).then(a.bind(a,93389)),requireAsync(e){const t=this.resolve(e);return this.resolved[t]=!1,this.importAsync(e).then(e=>(this.resolved[t]=!0,e))},requireSync(e){const t=this.resolve(e);return a(t)},resolve:()=>93389},{})},19951:(e,t,a)=>{a.d(t,{Z:()=>s});a(57627);const s=(0,a(97787).Z)({resolved:{},chunkName:()=>"PlaySimilarGamesManager.component.async",isReady(e){const t=this.resolve(e);return!0===this.resolved[t]&&!!a.m[t]},importAsync:()=>a.e(9359).then(a.bind(a,4219)),requireAsync(e){const t=this.resolve(e);return this.resolved[t]=!1,this.importAsync(e).then(e=>(this.resolved[t]=!0,e))},requireSync(e){const t=this.resolve(e);return a(t)},resolve:()=>4219},{})},96497:(e,t,a)=>{a.d(t,{_:()=>s});a(57627);const s=(0,a(97787).Z)({resolved:{},chunkName:()=>"PromocodesModal.component.async",isReady(e){const t=this.resolve(e);return!0===this.resolved[t]&&!!a.m[t]},importAsync:()=>Promise.all([a.e(6122),a.e(2642)]).then(a.bind(a,91549)),requireAsync(e){const t=this.resolve(e);return this.resolved[t]=!1,this.importAsync(e).then(e=>(this.resolved[t]=!0,e))},requireSync(e){const t=this.resolve(e);return a(t)},resolve:()=>91549},{resolveComponent:e=>e.PromocodesModal})},42215:(e,t,a)=>{a.d(t,{Z:()=>s});a(57627);const s=(0,a(97787).Z)({resolved:{},chunkName:()=>"ShortcutPopup.component.async",isReady(e){const t=this.resolve(e);return!0===this.resolved[t]&&!!a.m[t]},importAsync:()=>a.e(6587).then(a.bind(a,22717)),requireAsync(e){const t=this.resolve(e);return this.resolved[t]=!1,this.importAsync(e).then(e=>(this.resolved[t]=!0,e))},requireSync(e){const t=this.resolve(e);return a(t)},resolve:()=>22717},{})},87997:(e,t,a)=>{a.d(t,{Z:()=>s});a(57627);const s=(0,a(97787).Z)({resolved:{},chunkName:()=>"ShortcutManager.component.async",isReady(e){const t=this.resolve(e);return!0===this.resolved[t]&&!!a.m[t]},importAsync:()=>a.e(18).then(a.bind(a,2228)),requireAsync(e){const t=this.resolve(e);return this.resolved[t]=!1,this.importAsync(e).then(e=>(this.resolved[t]=!0,e))},requireSync(e){const t=this.resolve(e);return a(t)},resolve:()=>2228},{ssr:!1})},84490:(e,t,a)=>{a.d(t,{Z:()=>n});a(57627);var s=a(97787),i=a(44914);const n=(0,s.Z)({resolved:{},chunkName:()=>"GameInfo.component.async",isReady(e){const t=this.resolve(e);return!0===this.resolved[t]&&!!a.m[t]},importAsync:()=>a.e(805).then(a.bind(a,15093)),requireAsync(e){const t=this.resolve(e);return this.resolved[t]=!1,this.importAsync(e).then(e=>(this.resolved[t]=!0,e))},requireSync(e){const t=this.resolve(e);return a(t)},resolve:()=>15093},{error:i.Z})},87551:(e,t,a)=>{a.r(t),a.d(t,{default:()=>re});var s=a(89131),i=a(66287),n=a(43774),o=a(63904),r=a.n(o),l=a(87363),c=a.n(l),d=a(30928),h=a(38225),u=a(89875),p=a(25742),m=a(50678),g=a(95694),v=a(57627),w=a(36329),f=a(73146);var y=a(4545),b=a(34647),x=a(55990),C=a(51340),_=a(24051),P=a(39138),S=a(78825),I=a(74516);const k=({gameData:e,gameRemovalDate:t})=>{const{isNeedToShow:a}=(0,l.useContext)(_.u),{lang:s}=(0,l.useContext)(m.Z),i=(0,P.T)(),[n,o]=(0,l.useState)(!0),r=(0,l.useCallback)(()=>{S.Z.post({type:"game-removal-screen",action:"close"}),o(!1)},[]),c=(()=>{const{pathsMapping:e}=(0,l.useContext)(m.Z),{basePath:t}=(0,y.getDomainConfig)();return(0,l.useMemo)(()=>{const a=(0,b.Cx)({pathsMapping:e},{tagId:"top_igry_856"});return`${t}${a}`},[t,e])})(),d=(0,l.useMemo)(()=>t.toLocaleString(s,{day:"numeric",month:"long"}).replace(/\s/g,"Â "),[t,s]);return n&&!a?(0,v.jsxs)(C.Z,{buttonClassName:"GameRemovalPopup-critical-game-module__closeButton--wK6kR",closeButtonColor:"black",closeButtonType:"game-removal-popup",containerClassName:"GameRemovalPopup-critical-game-module__wrapper--FlaGb",testId:"game-removal-popup",onClose:r,children:[(0,v.jsx)("div",{className:"GameRemovalPopup-critical-game-module__gameIconBlock--wbUYw",children:(0,v.jsxs)("div",{className:"GameRemovalPopup-critical-game-module__gameIconWrapper--Eo5zF",children:[(0,v.jsx)(f.Z,{alt:e.title,appID:e.appID,media:e.media,mix:"GameRemovalPopup-critical-game-module__gameIcon--kuORE",size:I.KL.pjpg84x84}),(0,v.jsx)("div",{className:"GameRemovalPopup-critical-game-module__prohibitionIconWrapper--x2Kv6",children:(0,v.jsx)(x.Z,{alt:i("game.removed_soon.title",{params:{date:d}}),className:"GameRemovalPopup-critical-game-module__prohibitionIcon--qYzge",type:"prohibition-sign"})})]})}),(0,v.jsxs)("div",{className:"GameRemovalPopup-critical-game-module__textBlock--noRAa",children:[(0,v.jsx)("div",{className:"GameRemovalPopup-critical-game-module__title--wNqVD",children:i("game.removed_soon.title",{params:{date:d}})}),(0,v.jsx)("div",{className:"GameRemovalPopup-critical-game-module__description--LdNLE",children:i("game.removed_soon.description")})]}),(0,v.jsx)(w.z,{href:c,iconLeft:(0,v.jsx)(x.Z,{className:"GameRemovalPopup-critical-game-module__newTabIcon--Bi75J",type:"new-tab-with-arrow"}),size:40,target:"_blank",view:"primary",children:i("game.removed_soon.button")})]}):null};var E=a(12883),j=a(26156),A=a(64317),L=a(22097),D=a(16647),M=a(34816),N=a(41353),T=a(34095),O=a(19951),Z=a(92341),R=Object.defineProperty,B=Object.defineProperties,F=Object.getOwnPropertyDescriptors,G=Object.getOwnPropertySymbols,U=Object.prototype.hasOwnProperty,W=Object.prototype.propertyIsEnumerable,$=(e,t,a)=>t in e?R(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a;const H=r().with("screen-manager-rotate-banner"),V=()=>{S.Z.post({type:"screen-manager",action:"request-fullscreen"})},q=e=>{const t=(0,P.T)(),a=i.default.isLockable,s=(0,l.useCallback)(e=>{window.blur(),setTimeout(()=>{null==e||e.focus(),window.focus(),window.dispatchEvent(new Event("focus"))},1)},[]);return(0,v.jsx)(Z.Z,(n=((e,t)=>{for(var a in t||(t={}))U.call(t,a)&&$(e,a,t[a]);if(G)for(var a of G(t))W.call(t,a)&&$(e,a,t[a]);return e})({},e),o={children:a&&(0,v.jsx)("div",{className:H("button-wrapper"),children:(0,v.jsx)(w.z,{className:H("force-rotate-button"),ref:s,size:40,view:"primary",onClick:V,children:t("rotate.banner.button.text.short")})})},B(n,F(o))));var n,o};var z=a(73520),K=a(3465),X=a(40815),Y=a(23111),J=a(20966),Q=a(87125),ee=a(60617),te=Object.defineProperty,ae=(e,t,a)=>(((e,t,a)=>{t in e?te(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a})(e,"symbol"!=typeof t?t+"":t,a),a);const se=(0,Q.M$)("AppPageBody",Q.XG.Dev),ie=r().with("game-root"),ne=()=>{const{gameRemovalDate:e,middleLayerInGameData:t,playPageData:{gameData:a}}=(0,l.useContext)(m.Z),s=(0,h.C)(e=>{var t;return null==(t=e.middleLayerInGameData)?void 0:t.show}),[i,n]=(0,l.useState)(null);return(0,l.useEffect)(()=>{if(!e)return;const t=(0,E.h)(e);null===t?(0,J.H)({additional:{gameRemovalDate:e,validationResult:t},message:"Invalid removal date",source:"game-body.async.tsx"}):n(t)},[e]),(0,v.jsxs)(N.Z,{children:[!t&&(0,v.jsx)(T.P,{}),s&&(0,v.jsx)(A.P,{}),i&&a&&(0,v.jsx)(k,{gameData:a,gameRemovalDate:i})]})};class oe extends m.P{constructor(e,t){var a,s;super(e,t),ae(this,"stackRef"),ae(this,"limitedFsCheckerRef"),ae(this,"isIOSLimitedFsAvailable"),ae(this,"isFixedIOSLimitedFs"),ae(this,"isIOSLimitedFsDisableOnScale"),ae(this,"limitedFsUpdateIntervalId"),ae(this,"state",{isLimitedFullscreenActive:!1,isStickyShown:this.context.isStickyEnabled,showDragOverlay:!1,drawerVisible:!1}),ae(this,"onStickyManagerInternalMessage",e=>{const{action:t}=e.data;"on-show"===t?this.setState({isStickyShown:!0}):"on-hide"===t&&this.setState({isStickyShown:!1})}),ae(this,"onDrawerVisibleChange",e=>{this.setState({drawerVisible:e})}),ae(this,"handleOrientationChange",()=>{var e;const{isPortrait:t}=i.default;t?(clearInterval(this.limitedFsUpdateIntervalId),this.state.isLimitedFullscreenActive&&(null==(e=window.clickdaemonLog)||e.call(window,z.C.SWIPE2FS,{item:"rotationInFullscreen"})),this.setState({isLimitedFullscreenActive:!1,showDragOverlay:!1})):this.limitedFsUpdateIntervalId=window.setInterval(()=>{this.updateLimitedFsState()},300)}),ae(this,"setLimitedFullscreenActive",()=>{this.setState({isLimitedFullscreenActive:!0,showDragOverlay:!1})}),ae(this,"handleTouchMove",e=>{this.state.isLimitedFullscreenActive&&e.preventDefault()}),this.stackRef=c().createRef(),this.limitedFsCheckerRef=c().createRef();const{abt:{flags:n}}=t;this.isIOSLimitedFsAvailable=Boolean(t.isSafari)&&(0,ee.Xv)(n)&&"portrait"!==(null==(s=null==(a=t.playPageData.gameData)?void 0:a.features)?void 0:s.orientation),this.isFixedIOSLimitedFs=this.isIOSLimitedFsAvailable&&(0,ee.r6)(n),this.isIOSLimitedFsDisableOnScale=(0,ee.PH)(n)}componentDidMount(){this.isIOSLimitedFsAvailable&&this.initLimitedIOSFs(),S.Z.onInternalMessage("sticky-manager",this.onStickyManagerInternalMessage,{withHistory:!0})}updateLimitedFsState(){var e;if(this.isIOSLimitedFsDisableOnScale&&(null==(e=this.limitedFsCheckerRef.current)?void 0:e.clientHeight)!==window.screen.availWidth)return void this.setState({isLimitedFullscreenActive:!1,showDragOverlay:!1});const{isLandscape:t}=i.default;if(t){const e=this.isLimitedFsReady(),t=(0,ee.mD)(this.context.abt.flags)&&this.props.isSwipe2FullscreenOverlayLocked;this.setState({isLimitedFullscreenActive:e,showDragOverlay:!e&&!t})}}initLimitedIOSFs(){window.addEventListener("touchmove",this.handleTouchMove,{passive:!1});const{isLandscape:e}=i.default;e&&(this.limitedFsUpdateIntervalId=window.setInterval(()=>{this.updateLimitedFsState()},300)),i.default.addChangeListener(this.handleOrientationChange)}componentDidUpdate(e,t){var a,s,i;!t.showDragOverlay&&this.state.showDragOverlay&&(null==(a=window.clickdaemonLog)||a.call(window,z.C.SWIPE2FS,{item:"renderOverlay"}),S.Z.post({type:"document-events",action:"show-swipe-to-fullscreen-overlay"})),t.showDragOverlay&&!this.state.showDragOverlay&&(null==(s=window.clickdaemonLog)||s.call(window,z.C.SWIPE2FS,{item:"closeOverlay"}),S.Z.post({type:"document-events",action:"hide-swipe-to-fullscreen-overlay"})),!t.isLimitedFullscreenActive&&this.state.isLimitedFullscreenActive&&(null==(i=window.clickdaemonLog)||i.call(window,z.C.SWIPE2FS,{item:"enterFullscreen"}))}componentWillUnmount(){this.isIOSLimitedFsAvailable&&(i.default.removeChangeListener(this.handleOrientationChange),window.removeEventListener("touchmove",this.handleTouchMove),clearInterval(this.limitedFsUpdateIntervalId)),S.Z.offInternalMessage("sticky-manager",this.onStickyManagerInternalMessage)}isLimitedFsReady(){return!(!this.stackRef.current||!this.limitedFsCheckerRef.current)&&this.stackRef.current.clientHeight>=this.limitedFsCheckerRef.current.clientHeight}getStackClass(){let e="stack";if("undefined"!=typeof window){const t=document.querySelector(".stack"),a=`${e}_type_ios-limited-fs`;this.isIOSLimitedFsAvailable&&t&&!t.classList.contains(a)&&t.classList.add(a),e=(null==t?void 0:t.className)||e}return e}render(){se("render");const{appData:e,middleLayerInGameShow:t}=this.props,{hidePaymentsAndCurrency:a,isStickyEnabled:s,playPageData:i}=this.context,{gameSettings:{features:o}}=i,r=null==o?void 0:o.orientation,{hasHeader:l}=e,c="portrait"!==r&&!this.state.drawerVisible&&(!!this.isFixedIOSLimitedFs||this.state.showDragOverlay);return(0,v.jsxs)(K.I,{children:[c&&(0,v.jsx)("div",{className:ie("fs-spacer")}),(0,v.jsx)(M.Z,{isFixedIOSLimitedFs:this.isFixedIOSLimitedFs,isIOSLimitedFsAvailable:this.isIOSLimitedFsAvailable,isLimitedFullscreenActive:this.state.isLimitedFullscreenActive,isVisible:l&&!0,onMenuVisibleChange:this.onDrawerVisibleChange}),(0,v.jsxs)("main",{className:this.getStackClass(),ref:this.stackRef,children:[s&&(0,v.jsx)(u.Z,{hideAdvCloseButton:a,wrapperRef:this.stackRef}),(0,v.jsx)(D.Z,{showDragOverlay:this.state.showDragOverlay,onDragOverlayCloseByButton:this.setLimitedFullscreenActive}),(0,v.jsx)(q,{}),(0,v.jsx)("div",{className:"rotate-banner"}),(0,v.jsx)(n.hW,{offComponent:(0,v.jsx)(L.Z,{}),on:"adv_ingame_new",onComponent:(0,v.jsx)(p.Z,{})}),!t&&(0,v.jsx)(O.Z,{isBlackFadeout:!0}),(0,v.jsx)(ne,{}),!1,(0,v.jsx)(g.Z,{}),(0,v.jsx)(j.Z,{})]}),(0,v.jsx)(Y.T,{}),(0,v.jsx)(X.x,{isIOSLimitedFsAvailable:this.isIOSLimitedFsAvailable,ref:this.limitedFsCheckerRef,onDrawerVisibleChange:this.onDrawerVisibleChange})]})}}ae(oe,"contextType",m.Z);const re=(0,s.E)((0,d.$j)(function(e){var t;return{middleLayerInGameShow:null==(t=e.middleLayerInGameData)?void 0:t.show,shouldShowAndroidShortcutDrawer:e.shouldShowAndroidShortcutDrawer,isSwipe2FullscreenOverlayLocked:e.isSwipe2FullscreenOverlayLocked,userData:e.userData}})(oe))},86468:(e,t,a)=>{a.d(t,{GF:()=>n,_j:()=>o,yY:()=>i});var s=a(67016);const i=(0,s.U)("play_game_header_logo_click",()=>({type:"click",elem:"play_game_header_logo"})),n=(0,s.U)("play_game_header_fullscreen",e=>({type:"click",elem:"play_game_header_fullscreen",place:e})),o=(0,s.U)("header_game_info_button",()=>({type:"click",elem:"header_game_info_button"}))},38045:(e,t,a)=>{a.d(t,{Z:()=>h});var s=a(57627),i=a(87363),n=a(68927),o=a(55990),r=a(77314),l=a(39138),c=a(4522),d=a(60617);const h=({iconClass:e,onClick:t,mix:a,onEnable:h})=>{const u=(0,l.T)(),p=(0,n.TH)(),{abt:{flags:m},isPWA:g,isGamesApp:v,deviceType:w}=(0,r.b)();return(0,i.useMemo)(()=>{const e="mobile"===w&&g&&(0,d.Xd)(m),t=new URLSearchParams(p.search);return e||v||"1"===t.get("exit-button")},[w,m,v,g,p.search])?(h(),(0,s.jsx)(s.Fragment,{children:(0,s.jsx)("div",{className:(0,c.E)("ExitButton-critical-module__icon--rnLg0",a,"hover","pointer"),"data-testid":"exit-button",title:u("header.button.exit.text"),onClick:t,children:(0,s.jsx)(o.Z,{alt:u("common.close"),className:(0,c.E)(e),type:"exit"})})})):null}},18449:(e,t,a)=>{a.d(t,{Z:()=>g});var s=a(57627),i=a(63904),n=a.n(i),o=a(87363),r=a.n(o),l=a(38225),c=a(96533),d=a(55990),h=a(39138),u=a(4522);function p(e){if(e<=0)return"0";try{return new Intl.NumberFormat("ru-RU",{minimumFractionDigits:1,maximumFractionDigits:1}).format(e)}catch(e){}return String(e.toPrecision(2)).replace(".",",")}const m=n().with("game-rating-description"),g=r().memo(({dataTestId:e,hasWebAppsCategory:t,middleLayer:a,mix:i="",rating:n,useNewText:o,withoutText:r})=>{const g=(0,h.T)(),v=(0,l.C)(c.Up);if(0===n)return null;let w;return w=a?g("game.rating.new"):o?g(t?"game.rating.users.new":"game.rating.new"):g("game.rating").toLowerCase(),(0,s.jsxs)("div",{className:(0,u.E)(m(),i),"data-testid":e&&`${e}-game-rating-description`,title:g("game.rating"),children:[(0,s.jsxs)("div",{className:m("star-wrapper"),children:[(0,s.jsx)(d.Z,{className:m("rating-star",{dark:v}),type:"rating-star"}),(0,s.jsx)("span",{className:m("rating"),children:p(n)})]}),!r&&(0,s.jsx)("div",{className:m("text",{new:o}),children:w})]})})},31109:(e,t,a)=>{a.d(t,{Z:()=>Ce});var s=a(57627),i=a(43774),n=a(87363),o=a(38225),r=a(33249),l=a(63370),c=a(3914),d=a(36329),h=a(55990);var u=a(39138),p=a(4522);const m=()=>(0,s.jsx)(h.Z,{className:"MiddleLayerBack-critical-game-module__backIcon--bZMlJ",type:"arrow-short-back"});function g({className:e,onBack:t}){const a=(0,u.T)(),n=(0,i.v_)({on:"new_game_navigation"});return(0,s.jsx)(d.z,{className:(0,p.E)("MiddleLayerBack-critical-game-module__container--JcXN0",n&&"MiddleLayerBack-critical-game-module__newNavigation--LYg82",e),"data-testid":"middle-layer-back",iconLeft:m,size:40,view:n?"secondary-transparent":"empty",onClick:t,children:a(n?"all-games.heading":"common.back")})}var v=a(73146),w=a(45005),f=a(85144),y=a(92026),b=a(34057),x=a(16943),C=a(41280),_=a(77314);function P(){var e;const{playPageData:t}=(0,_.b)(),{gameSettings:a}=t;return null==(e=a.features)?void 0:e.age_rating}const S=[];var I=a(49291),k=a(50337);const E="MiddleLayerCategoryAndDeveloper-critical-module__separator--AJTp5";function j(){var e;const{playPageData:t}=(0,_.b)(),{gameInfo:a}=t,i=null==(e=t.gameData)?void 0:e.appID,o=(0,n.useCallback)(e=>{i&&y.H.dispatch((0,f.KB)(i,e))},[i]),r=function(){const{playPageData:e,categoryDataMappedByID:t}=(0,_.b)(),{gameData:a}=e,s=null==a?void 0:a.categoryIDs;return(0,n.useMemo)(()=>s?s.map(e=>t[e]).filter(Boolean):S,[s,t])}(),l=function(){var e;const{playPageData:t}=(0,_.b)();return null==(e=t.gameData)?void 0:e.developer}(),c=P();if(!r.length&&!l)return null;const d=!a.gameQualityScore&&!a.rating;return(0,s.jsxs)("div",{className:"MiddleLayerCategoryAndDeveloper-critical-module__categoriesAndDeveloper--q_1kV","data-testid":"middle-layer-categories-and-developer",children:[r.length>0&&(0,s.jsx)("div",{className:"MiddleLayerCategoryAndDeveloper-critical-module__categories--wfzoG",children:r.map(e=>(0,s.jsx)(b.Z,{iconClassname:"MiddleLayerCategoryAndDeveloper-critical-module__categoryIcon--Fxpid",mix:"MiddleLayerCategoryAndDeveloper-critical-module__category--LhMfD",name:e.name,title:e.title,type:x.q.CLEAR,withIcon:!0,withLink:!0,onClick:o},e.name))}),l&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(I.Z,{className:E}),(0,s.jsx)(C.n,{developer:l,mix:"MiddleLayerCategoryAndDeveloper-critical-module__developer--gpgHp",withPlayer:!0})]}),d&&c&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(I.Z,{className:E}),(0,s.jsx)(w.Wd,{variant:k.Ft[c],children:c})]})]})}var A=a(18158),L=a(92769),D=a(95663),M=a(61712),N=a(34647);const T=()=>{const e=(0,D.f)(),[t,a]=(0,n.useState)(!1),{baseUrlWithLangPath:i,baseHost:o,playPageData:{gameInfo:{appId:r,appSlug:l,title:c}},pathsMapping:u}=(0,_.b)(),p=(0,n.useMemo)(()=>`${o}${i}${(0,N.TI)({pathsMapping:u},{appID:r,appSlug:l})}?utm_source=game_popup_menu`,[o,i,u,r,l]),m=(0,n.useRef)(null),g=(0,n.useCallback)(()=>{a(e=>{const t=!e;return t&&(0,M.U4)({},{borrowParams:{middleLayer:{action:"share-button"}}}),t})},[]),v=(0,n.useCallback)(()=>{a(!1)},[]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(d.z,{iconLeft:(0,s.jsx)(h.Z,{type:"share"}),ref:m,size:40,view:"secondary-transparent",onClick:g}),(0,s.jsx)(L.V,{buttonSize:40,buttonViewType:"secondary-transparent",direction:["top","bottom"],place:"middleLayer"}),e&&(0,s.jsx)(A.Z,{elementId:"ya-share2-game-menu",scope:"inplace",shareRef:m,shareTitle:c,shareUrl:p,visible:t,onClose:v})]})};var O=a(55031),Z=a(48896),R=a(24051),B=a(78825),F=a(38207);function G(e){const{handleEvent:t}=(0,n.useContext)(R.u),a=(0,o.T)(),s=(0,o.C)(r.Ec),{gameResume:i}=(0,F.ff)({reason:"middle_layer"});return(0,n.useCallback)(()=>{t(new CustomEvent("apply",{detail:{actionSource:O.EO.PlayButton}})),a((0,Z.eI)(!1)),B.Z.post({type:"middle-layer",action:"close"}),i(),s&&y.H.dispatch((0,f.z1)(s,e))},[t,a,i,s,e])}var U=a(15383);function W(){const e=(0,U.T)(),t=G("play_button"),a=(0,i.v_)({on:"new_game_navigation_simplified"}),n=(0,i.v_)({on:"new_game_navigation"})&&!a;return(0,s.jsxs)("div",{className:"MiddleLayerPlayAndLegal-critical-module__playAndLegal--QXO2W","data-testid":"middle-layer-play-and-legal",children:[(0,s.jsx)(d.z,{className:(0,p.E)("MiddleLayerPlayAndLegal-critical-module__apply--MImFg",n&&"MiddleLayerPlayAndLegal-critical-module__applyNewGameNavigation--V1FjC",a&&"MiddleLayerPlayAndLegal-critical-module__height48--uyUIk"),"data-guard-accept":!0,size:40,view:"primary",onClick:t,children:e}),n&&(0,s.jsx)(T,{})]})}var $=a(47018),H=a(18449);function V(){const e=function(){const{playPageData:e}=(0,_.b)(),{gameInfo:t}=e;return t.gameQualityScore}(),t=function(){const{playPageData:e}=(0,_.b)(),{gameInfo:t}=e;return t.rating}(),a=P();return e||t?(0,s.jsxs)("div",{className:"MiddleLayerRatings-critical-module__ratings--ciWMF","data-testid":"middle-layer-ratings",children:[e&&(0,s.jsx)($.Z,{value:e}),(0,s.jsx)(H.Z,{hasWebAppsCategory:!1,middleLayer:!0,rating:t}),a&&(0,s.jsx)(w.Wd,{variant:k.Ft[a],children:a})]}):null}var q=a(87343);function z(){const{playPageData:e}=(0,_.b)();return(0,q.T)(e.gameInfo.title)}function K(){const e=z(),t=G("title");return(0,s.jsx)("h1",{className:"MiddleLayerTitle-critical-module__title--Jp7Uf","data-guard-accept":!0,"data-testid":"middle-layer-title",onClick:t,children:e})}var X=a(74516);const Y={},J=()=>{const e=function(){const{playPageData:e}=(0,_.b)(),{gameData:t}=e;return null==t?void 0:t.media}(),t=z(),a=G("icon"),{playPageData:n}=(0,_.b)(),{gameData:o}=n,r=null==o?void 0:o.shortDescription;return(0,s.jsxs)("div",{className:(0,p.E)("MiddleLayerInfo-critical-module__container--DN6wy",(0,i.v_)({on:"new_game_navigation_simplified"})&&"MiddleLayerInfo-critical-module__containerSimplified--QmWNs"),"data-testid":"middle-layer-info",children:[(0,s.jsx)(v.Z,{alt:t,dataGuardAccept:!0,media:null!=e?e:Y,mix:"MiddleLayerInfo-critical-module__icon--mrdPB",size:X.rb.pjpg160x160_3x,onClick:a}),(0,s.jsxs)("div",{className:(0,p.E)("MiddleLayerInfo-critical-module__description--sxWoi",r&&"MiddleLayerInfo-critical-module__descriptionWithShortDescription--a7l8m"),children:[(0,s.jsx)(K,{}),r&&(0,s.jsx)("div",{className:"MiddleLayerInfo-critical-module__shortDescription--i9X9t",children:r}),(0,s.jsx)(V,{}),(0,s.jsx)(j,{}),(0,s.jsx)(W,{})]})]})};var Q=a(27987),ee=a(87154);const te="MiddleLayerMediaPreview-critical-game-module__wrapper--ZlD8l";let ae=!1;const se=({video:e})=>{const[t,a]=(0,n.useState)(!1),[r,l]=(0,n.useState)(!0),{playPageData:{gameInfo:c}}=(0,_.b)(),d=(0,o.C)(e=>e.fullDataAboutGames[c.appId]),h=d.media;(0,n.useEffect)(()=>{a(!1),l(!0);const e=window.setTimeout(()=>{a(!0)},50),t=window.setTimeout(()=>{l(!1)},5e3);return()=>{window.clearTimeout(t),window.clearTimeout(e)}},[e.previewSrc]);const u=(0,n.useCallback)(()=>{var e;!ae&&(0,i.v_)({on:"new_game_navigation"})&&(null==(e=window.clickdaemonLog)||e.call(window,"middle_layer_video_started",{appId:c.appId,game_id:c.appId}),ae=!0),l(!1)},[c.appId]);return(0,s.jsxs)("div",{className:"MiddleLayerMediaPreview-critical-game-module__video--qU50T","data-testid":"middle-layer-media-preview-video",children:[r&&(0,s.jsx)("div",{className:"MiddleLayerMediaPreview-critical-game-module__blur--LD1E9",style:{backgroundColor:e.hexColor,backgroundImage:`url(${e.previewSrc})`}}),!r&&e.isVertical&&(0,s.jsx)("img",{alt:d.title,className:"MiddleLayerMediaPreview-critical-game-module__videoBackround--iSksj",crossOrigin:"anonymous",loading:"lazy",src:e.previewSrc}),(0,s.jsx)(ee.Z,{game:d,hover:t,media:h,size:X.KL.pjpg350x209,skipPoster:!0,skipPreview:!0,videoFit:e.isVertical?"contain":"cover",onStartVideoPlay:u}),r&&(0,s.jsx)(Q.y,{position:"center",size:28,spinning:!0})]})};var ie=a(17034);const ne=()=>{var e;const{isSlowCountry:t,cdnUrl:a}=(0,_.b)(),{playPageData:{gameInfo:{appId:r}}}=(0,_.b)(),l=(0,o.C)(e=>e.fullDataAboutGames[r].media),c=(0,n.useMemo)(()=>{var e,t,a;if(!(null==(e=l.videos)?void 0:e.length))return;const s=l.videos[0];return{previewSrc:s.thumbnailUrl,fullsizeSrc:(i=s.thumbnailUrlPrefix||(n=s.thumbnailUrl,n.replace(/[^/]+$/,"")),`${i.replace(/\/$/,"")}/orig`),hexColor:l.cover.mainColor,isVertical:(null!=(t=s.height)?t:0)>(null!=(a=s.width)?a:0),type:1};var i,n},[l.cover.mainColor,l.videos]),d=(0,n.useMemo)(()=>{var e,s;if(!(null==(s=null==(e=l.screenshots)?void 0:e.desktop)?void 0:s.length))return;const i=l.screenshots.desktop[0],n=(0,ie.R)(t)?a:void 0,o=(0,X.rN)(i["prefix-url"],"portrait"===i.orientation?"portrait":"landscape",n);return{previewSrc:o.defaultSrc,fullsizeSrc:o.fullsizeSrc,hexColor:i.mainColor,type:0}},[a,null==(e=l.screenshots)?void 0:e.desktop,t]),h=(0,n.useMemo)(()=>c||d,[d,c]),u=(0,p.E)("MiddleLayerMediaPreview-critical-game-module__preview--HKXXY",(0,i.v_)({on:"new_game_navigation_simplified"})&&"MiddleLayerMediaPreview-critical-game-module__previewSimplified--_W8_I");return h?(0,s.jsx)("div",{className:te,"data-testid":"middle-layer-media-preview",children:(0,s.jsxs)("div",{className:u,children:[0===h.type&&(0,s.jsx)("div",{className:"MiddleLayerMediaPreview-critical-game-module__image--keTIN",style:{backgroundColor:null==h?void 0:h.hexColor,backgroundImage:`url(${null==h?void 0:h.fullsizeSrc})`}}),1===h.type&&(0,s.jsx)(se,{video:h})]})}):(0,s.jsx)("div",{className:te,"data-testid":"middle-layer-media-preview",children:(0,s.jsx)("div",{className:u,style:{backgroundColor:l.cover.mainColor}})})};function oe(e){const{handleEvent:t}=(0,n.useContext)(R.u);return(0,n.useCallback)(()=>{t(new CustomEvent(e))},[t,e])}const re=()=>{const e=G("gallery"),t=oe("cancel");return(0,s.jsxs)("section",{className:(0,p.E)("MiddleLayerPreviewBlock-critical-game-module__preview--xZJ9s",(0,i.v_)({on:"new_game_navigation_simplified"})&&"MiddleLayerPreviewBlock-critical-game-module__previewSimplified--Kr4uo"),"data-testid":"middle-layer-preview-block",children:[(0,s.jsx)(i.hW,{on:"new_game_navigation",onComponent:(0,s.jsx)(g,{className:"MiddleLayerPreviewBlock-critical-game-module__back--VPAMf",onBack:t})}),(0,s.jsx)(ne,{}),(0,s.jsx)("div",{className:"MiddleLayerPreviewBlock-critical-game-module__info--THRQS",children:(0,s.jsx)(J,{})}),(0,s.jsx)("div",{className:"MiddleLayerPreviewBlock-critical-game-module__background--soxfD","data-guard-accept":!0,onClick:e})]})};var le=a(25686),ce=a(48505),de=a(29513);var he=Object.defineProperty,ue=Object.defineProperties,pe=Object.getOwnPropertyDescriptors,me=Object.getOwnPropertySymbols,ge=Object.prototype.hasOwnProperty,ve=Object.prototype.propertyIsEnumerable,we=(e,t,a)=>t in e?he(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a;const fe=({containerClassName:e,similarToAppId:t})=>{const a=(0,u.T)(),n=(0,o.C)(r.Ec),{catalogSessionUid:l,currentTab:c,hasRecentGames:d,page:h,showCallbackTimeout:m}=(0,ce.I)(),g=null!=t?t:n,v=(0,o.C)(e=>{var t;return g?null==(t=e.similarGames)?void 0:t[g]:void 0});if(!(null==v?void 0:v.length))return null;const w=(0,i.v_)({on:"new_game_navigation"}),f=w?"similar.new-navigation.middle-layer-game-page.title":"similar.middle-layer-game-page.title";return(0,s.jsxs)("section",{className:(0,p.E)("MiddleLayerSimilarGames-critical-game-module__wrapper--d6bC5",w&&"MiddleLayerSimilarGames-critical-game-module__newNavigation--NT02G"),children:[(0,s.jsx)("h2",{className:"MiddleLayerSimilarGames-critical-game-module__title--aFrC6","data-testid":"middle-layer-similar-games-title",children:a(f)}),(0,s.jsx)("div",{className:(0,p.E)("MiddleLayerSimilarGames-critical-game-module__gridContainer--StRhV",e),children:v.map((e,t)=>{const a=function(e){return e%4}(t),i=function(e){return(e-e%4)/4}(t),n=(o=((e,t)=>{for(var a in t||(t={}))ge.call(t,a)&&we(e,a,t[a]);if(me)for(var a of me(t))ve.call(t,a)&&we(e,a,t[a]);return e})({},e),ue(o,pe({column:a,guard:!1,row:i})));var o;return(0,s.jsx)(le.Z,{catalogSessionUid:l,currentTab:c,eagerImageLoading:!0,game:n,hasInfo:!1,hasRecentGames:d,isCaption:!0,listType:de.co.SIMILAR,mix:"MiddleLayerSimilarGames-critical-game-module__gridItem--GYaaY",page:h,redirParams:{column:a,line:4,row:i,wrapperName:de.NK.GAME_PAGE},showCallbackTimeout:m,size:de.xY.ADAPTIVE_RECOMMENDED_NEW},e.appID)})})]})};var ye=a(76753);let be=!1;function xe(){"visible"===document.visibilityState&&requestAnimationFrame(()=>{window.focus()})}const Ce=()=>{const e=(0,n.useRef)(null),t=(0,o.C)(r.IE),a=G("early"),d=G("game_info"),h=oe("cancel"),u=(0,i.v_)({on:"new_game_navigation"});return function(e){(0,n.useEffect)(()=>{if(!(0,i.v_)({on:"new_game_navigation"})||!e.current)return;const t=e.current,a=()=>{var e;null==(e=window.clickdaemonLog)||e.call(window,"middle_layer_scroll",{})};return t.addEventListener("scroll",a,{once:!0}),()=>{t.removeEventListener("scroll",a)}},[e])}(e),function({onPlay:e}){(0,ye.q)(()=>{var t;be||(be=!0,null==(t=window.earlyEvents)||t.messages.forEach(t=>{const{type:a,action:s}=t;"guard"===a&&"accept"===s&&e()}))})}({onPlay:a}),function({onPlay:e}){(0,n.useEffect)(()=>{function t(t){"apply"===t.data.action&&e()}return B.Z.onInternalMessage("guard",t,{withHistory:!1}),()=>{B.Z.offInternalMessage("guard",t)}},[e])}({onPlay:d}),(0,ye.q)(()=>(document.addEventListener("visibilitychange",xe),()=>{document.removeEventListener("visibilitychange",xe)})),(0,s.jsxs)("article",{className:(0,p.E)("MiddleLayerInGame-critical-module__container--tzav3",c.P,t&&"MiddleLayerInGame-critical-module__withSimilar--ud1zP",u&&"MiddleLayerInGame-critical-module__newNavigation--tIqzF"),"data-testid":"middle-layer-in-game",ref:e,children:[(0,s.jsx)(i.hW,{offComponent:(0,s.jsx)(g,{className:"MiddleLayerInGame-critical-module__back--Qzqo9",onBack:h}),on:"new_game_navigation"}),(0,s.jsxs)("div",{className:"MiddleLayerInGame-critical-module__content--P6BuC",children:[(0,s.jsx)(re,{}),t&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(fe,{}),(0,s.jsx)("section",{className:"MiddleLayerInGame-critical-module__footer--NSyLM",children:(0,s.jsx)(l.Z,{withPartners:!1})})]})]})]})}},64317:(e,t,a)=>{a.d(t,{P:()=>s});const s=a(31109).Z},92341:(e,t,a)=>{a.d(t,{Z:()=>m});var s=a(57627),i=a(38225),n=a(77314),o=a(63904),r=a.n(o),l=a(87363),c=a(55031);const d=({className:e=""})=>{const{themeColor:t}=(0,n.b)();return t===c.aN.DARK?(0,s.jsxs)("svg",{className:e,fill:"none",height:"163",viewBox:"0 0 153 163",width:"153",xmlns:"http://www.w3.org/2000/svg",children:[(0,s.jsx)("path",{clipRule:"evenodd",d:"m135.778 4h-41.5558c-7.3024 0-13.2222 6.0674-13.2222 13.552v93.896c0 7.485 5.9198 13.552 13.2222 13.552h41.5558c7.302 0 13.222-6.067 13.222-13.552v-93.896c0-7.4846-5.92-13.552-13.222-13.552zm-5.178 4h-1.635c.023.16331.035.33025.035.50001 0 1.93299-1.567 3.49999-3.5 3.49999h-21c-1.933 0-3.5-1.567-3.5-3.49999 0-.16976.012-.3367.035-.50001h-1.635c-5.0405 0-7.5607 0-9.4859.98094-1.6935.86286-3.0703 2.23966-3.9332 3.93316-.9809 1.9252-.9809 4.4454-.9809 9.4859v84.2c0 5.04 0 7.561.9809 9.486.8629 1.693 2.2397 3.07 3.9332 3.933 1.9252.981 4.4454.981 9.4859.981h31.2c5.04 0 7.561 0 9.486-.981 1.693-.863 3.07-2.24 3.933-3.933.981-1.925.981-4.446.981-9.486v-84.2c0-5.0405 0-7.5607-.981-9.4859-.863-1.6935-2.24-3.0703-3.933-3.93316-1.925-.98094-4.446-.98094-9.486-.98094z",fill:"#fff",fillRule:"evenodd",opacity:".2"}),(0,s.jsx)("rect",{fill:"#454545",height:"68",rx:"14",width:"121",x:"4",y:"91"}),(0,s.jsx)("path",{clipRule:"evenodd",d:"m4 145.778v-41.556c0-7.3022 6.0674-13.222 13.552-13.222h93.896c7.485 0 13.552 5.9198 13.552 13.222v41.556c0 7.302-6.067 13.222-13.552 13.222h-93.896c-7.4846 0-13.552-5.92-13.552-13.222zm4-5.178v-1.635c.1633.023.33024.035.50001.035 1.93299 0 3.49999-1.567 3.49999-3.5v-21c0-1.933-1.567-3.5-3.49999-3.5-.16977 0-.33671.012-.50001.035v-1.635c0-5.04 0-7.561.98094-9.4859.86286-1.6935 2.23966-3.0703 3.93316-3.9332 1.9252-.9809 4.4454-.9809 9.4859-.9809h84.2c5.04 0 7.561 0 9.486.9809 1.693.8629 3.07 2.2397 3.933 3.9332.981 1.9249.981 4.4459.981 9.4859v31.2c0 5.04 0 7.561-.981 9.486-.863 1.693-2.24 3.07-3.933 3.933-1.925.981-4.446.981-9.486.981h-84.2c-5.0405 0-7.5607 0-9.4859-.981-1.6935-.863-3.0703-2.24-3.93316-3.933-.98094-1.925-.98094-4.446-.98094-9.486z",fill:"#fff",fillRule:"evenodd"}),(0,s.jsx)("path",{className:"arrow_left",d:"m35.9999 69.6001c3.3485 3.3485 5.2259 5.2259 8.5745 8.5744",stroke:"#5641ff",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"6"}),(0,s.jsx)("path",{className:"arrow_right",d:"m52.8525 70.0005-8.1524 8.1526",stroke:"#5641ff",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"6"}),(0,s.jsx)("path",{className:"arrow_tail",d:"m41.7002 76c0 1.6569 1.3431 3 3 3 1.6568 0 3-1.3431 3-3zm27-22c1.6568 0 3-1.3431 3-3s-1.3432-3-3-3zm-21 22v-13h-6v13zm9-22h12v-6h-12zm-9 9c0-4.9706 4.0294-9 9-9v-6c-8.2843 0-15 6.7157-15 15z",fill:"#5641ff"})]}):(0,s.jsxs)("svg",{className:e,fill:"none",height:"163",viewBox:"0 0 153 163",width:"153",xmlns:"http://www.w3.org/2000/svg",children:[(0,s.jsxs)("g",{opacity:"0.5",children:[(0,s.jsx)("rect",{fill:"#CFCFDC",height:"125",rx:"14",stroke:"white",strokeWidth:"4",transform:"matrix(-1 0 0 1 153 4)",width:"72",x:"2",y:"-2"}),(0,s.jsx)("path",{clipRule:"evenodd",d:"M128.965 8H130.6C135.64 8 138.161 8 140.086 8.98094C141.779 9.8438 143.156 11.2206 144.019 12.9141C145 14.8393 145 17.3595 145 22.4V106.6C145 111.64 145 114.161 144.019 116.086C143.156 117.779 141.779 119.156 140.086 120.019C138.161 121 135.64 121 130.6 121H99.4C94.3595 121 91.8393 121 89.9141 120.019C88.2206 119.156 86.8438 117.779 85.9809 116.086C85 114.161 85 111.64 85 106.6L85 22.4C85 17.3595 85 14.8393 85.9809 12.9141C86.8438 11.2206 88.2206 9.8438 89.9141 8.98094C91.8393 8 94.3595 8 99.4 8H101.035C101.012 8.16331 101 8.33025 101 8.50001C101 10.433 102.567 12 104.5 12L125.5 12C127.433 12 129 10.433 129 8.50001C129 8.33025 128.988 8.16331 128.965 8Z",fill:"#F4F4F6",fillRule:"evenodd"})]}),(0,s.jsx)("rect",{fill:"#90919D",height:"125",rx:"14",stroke:"white",strokeWidth:"4",transform:"rotate(-90 2 161)",width:"72",x:"2",y:"161"}),(0,s.jsx)("path",{clipRule:"evenodd",d:"M7.99999 138.965V140.6C7.99999 145.64 7.99999 148.161 8.98093 150.086C9.84379 151.779 11.2206 153.156 12.9141 154.019C14.8393 155 17.3595 155 22.4 155H106.6C111.64 155 114.161 155 116.086 154.019C117.779 153.156 119.156 151.779 120.019 150.086C121 148.161 121 145.64 121 140.6V109.4C121 104.36 121 101.839 120.019 99.9141C119.156 98.2206 117.779 96.8438 116.086 95.9809C114.161 95 111.64 95 106.6 95H22.4C17.3595 95 14.8393 95 12.9141 95.9809C11.2206 96.8438 9.84379 98.2206 8.98093 99.9141C7.99999 101.839 7.99999 104.36 7.99999 109.4V111.035C8.16329 111.012 8.33023 111 8.5 111C10.433 111 12 112.567 12 114.5L12 135.5C12 137.433 10.433 139 8.5 139C8.33023 139 8.16329 138.988 7.99999 138.965Z",fill:"#F4F4F6",fillRule:"evenodd"}),(0,s.jsx)("path",{className:"arrow_left",d:"M35.9999 69.6001C39.3484 72.9486 41.2258 74.826 44.5744 78.1745",stroke:"#5641FF",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"6"}),(0,s.jsx)("path",{className:"arrow_right",d:"M52.8525 70.0004L44.7001 78.153",stroke:"#5641FF",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"6"}),(0,s.jsx)("path",{className:"arrow_tail",d:"M41.7002 76C41.7002 77.6569 43.0433 79 44.7002 79C46.357 79 47.7002 77.6569 47.7002 76H41.7002ZM68.7002 54C70.357 54 71.7002 52.6569 71.7002 51C71.7002 49.3431 70.357 48 68.7002 48V54ZM47.7002 76V63H41.7002V76H47.7002ZM56.7002 54H68.7002V48H56.7002V54ZM47.7002 63C47.7002 58.0294 51.7296 54 56.7002 54V48C48.4159 48 41.7002 54.7157 41.7002 63H47.7002Z",fill:"#5641FF"})]})};var h=a(39138);const u=r().with("screen-manager-rotate-banner"),p=({orientation:e,children:t})=>{const a=(0,h.T)(),i=(0,l.useMemo)(()=>a("rotate.banner.description",{params:{orientation:a("landscape"===e?"rotate.banner.description.orientation.landscape":"rotate.banner.description.orientation.portrait")}}).split("\\n").flatMap((e,t)=>t?[(0,s.jsx)("br",{},t),e]:e),[e,a]),{themeColor:o}=(0,n.b)();return(0,s.jsxs)("div",{className:`${u({orientation:e,theme:o})} with-play-game-header-fix`,children:[(0,s.jsx)(d,{className:u("image")}),(0,s.jsx)("div",{className:u("title"),children:a("rotate.banner.action.text")}),(0,s.jsx)("div",{className:u("description"),children:i}),t]})},m=({children:e})=>{const t=(0,i.C)(e=>e.ui.screenOrientationBannerVisible),{playPageData:a}=(0,n.b)();if(!t)return null;const{orientation:o}=a.gameSettings.features||{},r=(e=>{if("landscape"===e||"portrait"===e)return e})(o);return r?(0,s.jsx)(p,{orientation:r,children:e}):null}},97856:(e,t,a)=>{a.d(t,{K:()=>u});var s=a(57627),i=a(36329),n=a(87363),o=a(38225),r=a(24051),l=a(41353),c=a(39138),d=a(45310);const h=({size:e=24})=>{const t=(0,n.useContext)(r.u),a=(0,c.T)(),o=(0,n.useCallback)(()=>{t.handleEvent(new CustomEvent("auth"))},[t]);return(0,s.jsxs)(i.z,{className:"MiddleLayerLoginButton-critical-game-module__button--Fgw5A","data-guard-auth":"true",size:e,view:"secondary",onClick:o,children:[(0,s.jsx)("span",{children:a("authpopup.button.login")})," ",(0,s.jsx)("span",{className:"MiddleLayerLoginButton-critical-game-module__secondaryCaption--Jq9T7",children:a("authpopup.button.caption")})]})},u=({size:e=24})=>{const t=(0,o.C)(e=>{var t;return Boolean(null==(t=e.middleLayerInGameData)?void 0:t.show)}),a=(0,o.C)(e=>Boolean(e.userData.uid));return!t||a||(0,d.I)()?null:(0,s.jsx)(l.Z,{children:(0,s.jsx)(h,{size:e})})}},74578:(e,t,a)=>{a.d(t,{Z:()=>H});var s=a(57627),i=a(43774),n=a(87363),o=a(38225),r=a(86468),l=a(92026),c=a(33249),d=a(36329),h=a(77314),u=a(78825),p=a(4522),m=a(87343),g=a(83959),v=a(94365),w=a(61712),f=a(72895),y=a(29513),b=a(34647);const x=()=>{const{baseUrlWithLangPath:e,hidePaymentsAndCurrency:t,location:a,playPageData:{gameInfo:{appId:o,appSlug:c,title:x}},pathsMapping:C,referrer:_}=(0,h.b)(),P=(0,v.Px)({search:"utm_source=game_header_title&info=true",params:{[y.o1]:t?"1":"",[y.om]:(0,g.V)(y.om,a)||"",[y.Vw]:(0,f.sD)(_)?_:""}}),S=`${e}${(0,b.TI)({pathsMapping:C},{appID:o,appSlug:c})}${P}`,I=(0,m.T)(x),k=(0,n.useCallback)(e=>{e.preventDefault(),u.Z.post({type:"document-events",action:"show-info"}),l.H.dispatch((0,r._j)()),(0,w.U4)({},{borrowParams:{header:{action:"app-page"}}})},[]),E=(0,i.v_)({on:"new_game_navigation_simplified"});return(0,s.jsx)(d.z,{className:(0,p.E)(E&&"header-game-info-button-critical-game-module__simplified--bV72J"),"data-testid":"header-game-info-button",href:S,rounded:!0,size:E?40:32,view:E?"empty":"secondary",onClick:k,children:I})};var C=a(43908),_=a(39138),P=a(60617);const S=()=>{const{abt:{flags:e},hidePortalCurrency:t}=(0,h.b)(),a=(0,_.T)(),n=t||(0,P.Sn)(e),r=!(0,o.C)(e=>{var t;return Boolean(null==(t=e.middleLayerInGameData)?void 0:t.show)})&&!(0,i.v_)({on:"new_game_navigation_simplified"});return n?null:(0,s.jsx)("div",{title:a("header.button.balance.text"),children:(0,s.jsx)(C.Z,{isCurrencyColorInverted:r,type:"game"})})};var I=a(45682),k=a(60362),E=a(68927),j=a(38045),A=a(55854),L=a(76753),D=a(97833),M=a(69874);const N=()=>{};let T,O=0;const Z=()=>{const e=(0,h.b)(),{reqUrl:t,lang:a}=e,i=(0,E.TH)(),o=(0,n.useCallback)(s=>{if(s){const s=(0,D.l)({url:"/",source:{utm_source:"game_header_x_close"},location:i,lang:a,context:e}),n=(0,A.ky)(s,{currentLocation:t});window.open(n,"_self")}},[e,a,i,t]),r=(0,n.useCallback)(()=>{var e;(0,w.U4)({},{borrowParams:{header:{action:"exit"}}}),null==(e=window.clickdaemonLog)||e.call(window,"header_exit_click",{}),o(!0)},[o]),l=(e=>{const t=(0,n.useRef)(!1);return(0,n.useEffect)(()=>{},[e]),t})(o),c=(0,n.useCallback)(()=>{window.history.pushState("root",""),window.history.pushState("main-page",""),window.addEventListener("popstate",e=>{if("root"===e.state){if(window.history.pushState("main-page",""),l.current)return u.Z.postToChild((0,I.TI)(k.q1.HISTORY_BACK)),O>0&&clearTimeout(T),O++,void(T=setTimeout(()=>{var e,t;null==(t=null==(e=null==window?void 0:window.Ya)?void 0:e.Rum)||t.logEventString("history_back","",{additional:{backHandleCount:O}}),O=0},2e3));o()}},!0)},[l,o]);return(0,L.q)(()=>{const e=(0,M.c)(()=>{window.setTimeout(()=>c())},{once:!0});return()=>{e()}}),(0,s.jsx)(j.Z,{onClick:r,onEnable:N})};var R=a(97856),B=a(7820),F=a(89498),G=a(81032),U=a(56044),W=a(24754),$=a(92769);const H=({className:e,isVisible:t})=>{const[a,d]=(0,n.useState)(t),h=(0,o.C)(c.pz),m=(0,i.v_)({on:"new_game_navigation"})&&(0,i.v_)({off:"new_game_navigation_simplified"}),g=(0,n.useCallback)(()=>{var e;l.H.dispatch((0,r.yY)()),m&&(null==(e=window.clickdaemonLog)||e.call(window,"game_header_logo_click",{state:h?"middleLayer":"play"}))},[m,h]);return(0,L.q)(()=>{const e=e=>{const{action:t}=e.data;switch(t){case"show":d(!0);break;case"hide":d(!1)}};return u.Z.onInternalMessage("play-game-header",e),()=>{u.Z.offInternalMessage("play-game-header",e)}}),a?(0,s.jsxs)(B.Z,{className:(0,p.E)("game-header-critical-game-module__header--ECjeR","game-header",e),logo:(0,s.jsx)(F.Z,{additionalSearch:{utm_source:"game_header_logo"},openInNewWindow:!0,useOutLink:!0,onClick:g}),right:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(R.K,{size:32}),(0,s.jsx)(S,{}),!m&&(0,s.jsx)($.V,{place:"header"}),!m&&(0,s.jsx)(W.X,{place:"header"}),!h&&(0,s.jsx)(i.hW,{on:"login_game_header_action",onComponent:(0,s.jsx)(U.T,{classNameStripeAnimation:"game-header-critical-game-module__loginButton--g9Idg stripe-composables-module__stripe-related-header-btn--Fkuei",size:32})}),(0,s.jsx)(Z,{})]}),children:[m&&(0,s.jsx)(G.Z,{}),!m&&(0,s.jsx)(x,{})]}):null}},41280:(e,t,a)=>{a.d(t,{n:()=>v});var s=a(57627),i=a(87363),n=a(68927),o=a(55854),r=a(77314),l=a(4522),c=a(83959),d=a(94365),h=a(61712),u=a(55222),p=a(72895),m=a(29513),g=a(33376);const v=({developer:e,defaultTarget:t,mix:a,withPlayer:v})=>{const{isPWA:w,hidePaymentsAndCurrency:f,referrer:y,reqUrl:b,oneTabPWA:x,location:C}=(0,r.b)(),_=(0,n.TH)(),P=(0,d.Yk)(_.search,{[m.o1]:f?"1":"",[m.om]:(0,c.V)(m.om,C)||"",[m.Vw]:(0,p.sD)(y)?y:"",[m.cB]:w?"1":""});let S=t;x?S="_parent":v&&(S=(0,u.AO)());const I=e.id,k=e.name,E=(0,i.useCallback)(()=>{(0,h.NF)({},g.Ji.DEVELOPER_PAGE_CLICK)},[]);return I&&k?(0,s.jsx)(o.rU,{className:(0,l.E)("DeveloperLink-module__link--aoAFC","games-link",a),currentLocation:b,target:S,to:{pathname:`${m.WG}/${I}`,search:P,state:{internalStep:!0}},onClick:E,children:k}):null}},57700:(e,t,a)=>{a.d(t,{Z:()=>s});const s=a(95662).Z},57496:(e,t,a)=>{a.d(t,{Z:()=>ue});var s=a(57627),i=a(45682),n=a(60362),o=a(89131),r=a(43774),l=a(63904),c=a.n(l),d=a(87363),h=a.n(d),u=a(30928),p=a(86468),m=a(92026),g=a(96533),v=a(50678),w=a(43908),f=a(38045),y=a(97856),b=a(55990),x=a(55854),C=a(57700);var _=a(68927),P=a(38225),S=a(20958),I=a(13466),k=a(77314),E=a(39138),j=a(97833),A=a(55222),L=a(29513),D=a(60617),M=a(65745);const N=c().with("play-game-header-logo"),T=({isMiddleLayer:e}={})=>{const t=(0,k.b)(),{oneTabPWA:a,reqUrl:i,pathLang:n}=t,o=(0,E.T)(),r=(0,_.TH)(),l=(0,P.C)(S.D),c=(0,d.useMemo)(()=>{let e="/";return(0,D.Ly)()&&l===L.Qz&&(e="/home"),(0,j.l)({url:e,source:{utm_source:"game_header_logo"},location:r,lang:n,context:t})},[t,r,l,n]),h=e?M.q7.MIDDLE_LAYER_HEADER:M.q7.HEADER,u=(0,d.useCallback)(()=>{m.H.dispatch((0,p.yY)())},[]);return(0,s.jsx)(x.Kk,{className:`${N("link")} pointer`,currentLocation:i,href:c,tabIndex:-1,target:(0,A.AO)({oneTabPWA:a}),title:o("common.service.name"),onClick:u,children:(0,s.jsx)(I.Z,{type:h})})};var O=a(38411),Z=a(26812),R=a(24912),B=a(64151),F=a(19811);var G=a(4522);const U=({game:e,className:t})=>{const{isLiked:a,isDisliked:i}=(0,R.r)(e),{handleLikeToggle:n,handleDislikeToggle:o}=(0,Z.x)("game-header"),r=(0,O.o)(),l=(0,d.useRef)(null);return(0,s.jsxs)("div",{className:(0,G.E)("GameHeaderReactions-critical-module__gameHeaderReactions--_vtWo",t),ref:l,children:[(0,s.jsx)(F.A,{appID:e.appID,isActive:a,size:32,type:"like",view:"empty",onToggle:n}),(0,s.jsx)(F.A,{appID:e.appID,isActive:i,size:32,type:"dislike",view:"empty",onToggle:o}),r&&(0,s.jsx)(B.$,{anchor:l})]})};var W=a(56044),$=a(74938),H=a(78825),V=a(70931),q=a(32221),z=a(83959),K=a(87343),X=a(90336),Y=a(94365),J=a(61712),Q=a(72895),ee=a(7323),te=a(69874),ae=a(87125),se=a(14243),ie=a(34647),ne=Object.defineProperty,oe=(e,t,a)=>(((e,t,a)=>{t in e?ne(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a})(e,"symbol"!=typeof t?t+"":t,a),a);const re=c().with("play-game-header"),le=(0,ae.M$)("PlayGameHeader",ae.XG.Dev);let ce,de=0;class he extends v.P{constructor(e){super(e),oe(this,"menuAnchorRef",h().createRef()),oe(this,"backButtonListenerInGame",!1),oe(this,"clearingHistoryAndGoToCatalog"),oe(this,"isExitEnabled",!1),oe(this,"onPlayGameHeaderMessage",e=>{if(!this.props.isVisible)return;const{action:t}=e.data;"show"!==t?"hide"===t&&this.setState({visible:!1}):this.setState({visible:!0})}),oe(this,"onAppInfoClick",e=>{e.preventDefault(),m.H.dispatch((0,p._j)()),H.Z.post({type:"document-events",action:"show-info"}),this.sendParams("app-page")}),oe(this,"onExitButtonClick",()=>{this.sendParams("exit"),this.onExit(!0)}),oe(this,"onFullscreenButtonClick",()=>{this.sendParams("fullscreen"),this.toggleFullscreen(),m.H.dispatch((0,p.GF)("header"))}),oe(this,"onHeaderLogoClick",()=>{this.sendParams("logo")}),oe(this,"onMenuIconClick",()=>{const e=(0,se.hY)(se.jF.GUARD);e?(0,se.Vy)(e.children):(this.sendParams("menu"),this.setState({menuDotted:!1,menuVisible:!this.state.menuVisible}))}),oe(this,"onBackButtonClick",()=>{this.sendParams("hide-menu-back"),this.closeMenu({isMenuItem:!1,isBackLink:!0})}),oe(this,"handleMenuClose",e=>{this.closeMenu({isMenuItem:Boolean(null==e?void 0:e.isMenuItem),isBackLink:!1})}),oe(this,"closeMenu",e=>{e.isMenuItem||e.isBackLink||window.history.back(),this.setState({menuVisible:!1})}),oe(this,"isEnableExitButton",()=>{this.isExitEnabled=!0}),this.state={isFullscreen:!1,menuDotted:!1,menuVisible:!1,visible:e.isVisible}}get isAdvStickyBannerEnabled(){return(0,V.xm)(this.context.playPageData)}get isMiddleLayerShown(){var e;return Boolean(this.context.middleLayerInGameData)&&null!=(e=this.props.isMiddleLayerShownInGame)&&e}componentDidMount(){le("componentDidMount"),this.setMenuDotMarker(),this.checkExitEnabled(),this.setExitButtonAvalibility(),this.setBackButtonGameHandler(),this.initMessaging()}componentWillUnmount(){le("componentWillUnmount"),H.Z.offInternalMessage("play-game-header",this.onPlayGameHeaderMessage),this.removeBackButtonListener()}initMessaging(){H.Z.onInternalMessage("play-game-header",this.onPlayGameHeaderMessage)}sendParams(e){(0,J.U4)({},{borrowParams:{header:{action:e}}})}setMenuDotMarker(){var e,t,a;const s=!0===(null==(a=null==(t=null==(e=window.YandexGamesSDK)?void 0:e.game.settings)?void 0:t.extraFeatures)?void 0:a.leaderboards)&&!(0,ee.dq)(L.b_).value,i=!(0,ee.dq)(L.Z5).value&&Boolean(this.props.advEnabledByPartner);this.setState({menuDotted:s||i})}setExitButtonAvalibility(){this.isExitEnabled&&(0,te.c)(()=>{window.setTimeout(()=>this.handleHistoryBack())},{once:!0})}setBackButtonGameHandler(){}get isEmbeddedWindow(){return Boolean("object"==typeof window&&window.parent!==window)}isFullscreenButtonAvailable(){return!this.context.isIpad&&!(this.isEmbeddedWindow&&!(0,X.r)())&&!this.isExitEnabled&&this.props.isFullscreenEnabled}handleHistoryBack(){window.history.pushState("root",""),window.history.pushState("main-page",""),window.addEventListener("popstate",e=>{if(this.clearingHistoryAndGoToCatalog)null===e.state?function(e){const t=["utm_medium","utm_source"].reduce((e,a)=>{const s=(0,z.V)(a);return s&&(t[a]=s),e},{}),a=(0,q.Z)({url:`${e}/`,params:t});window.location.replace(a)}(this.context.baseUrl):setTimeout(()=>{window.history.back()},0);else if("root"===e.state){if(window.history.pushState("main-page",""),this.backButtonListenerInGame)return H.Z.postToChild((0,i.TI)(n.q1.HISTORY_BACK)),de>0&&clearTimeout(ce),de++,void(ce=setTimeout(()=>{var e,t;null==(t=null==(e=null==window?void 0:window.Ya)?void 0:e.Rum)||t.logEventString("history_back","",{additional:{backHandleCount:de}}),de=0},2e3));this.onExit()}},!0)}toggleFullscreen(){H.Z.post({type:"screen-manager",action:"toggle-fullscreen"})}exitToCatalog(){const{reqUrl:e}=this.context,t=(0,j.l)({url:"/",source:{utm_source:"game_header_x_close"},location:this.props.location,lang:this.props.lang,context:this.context}),a=(0,x.ky)(t,{currentLocation:e});window.open(a,"_self")}onExit(e){e&&this.exitToCatalog()}componentDidUpdate(e,t){t.menuVisible!==this.state.menuVisible&&(this.state.menuVisible?(this.addBackButtonListener(),this.props.gameControl.gamePause("play_game_header_menu")):(this.removeBackButtonListener(),this.props.gameControl.gameResume("play_game_header_menu")))}addBackButtonListener(){setTimeout(()=>window.history.pushState("menu","","#menu"),0),window.addEventListener("popstate",this.onBackButtonClick,!1)}removeBackButtonListener(){window.removeEventListener("popstate",this.onBackButtonClick)}renderLogo(){return(0,s.jsx)("span",{className:re("logo"),onClick:this.onHeaderLogoClick,children:(0,s.jsx)(T,{isMiddleLayer:this.isMiddleLayerShown})})}renderHeaderInfo(){const{baseUrlWithLangPath:e,referrer:t,hidePaymentsAndCurrency:a}=this.context;if(this.isMiddleLayerShown)return null;const{appId:i,appSlug:n,title:o}=this.context.playPageData.gameInfo,r=(0,Y.Px)({search:"utm_source=game_header_title&info=true",params:{[L.o1]:a?"1":"",[L.om]:(0,z.V)(L.om,this.context.location)||"",[L.Vw]:(0,Q.sD)(t)?t:""}}),l=`${e}${(0,ie.TI)(this.context,{appID:i,appSlug:n})}${r}`;return(0,s.jsx)("span",{className:re("info"),children:(0,s.jsxs)("span",{className:re("middle"),children:[(0,s.jsx)("a",{className:`${re("link")} hover pointer app-page`,href:l,target:"_blank",title:(0,K.T)(o),onClick:this.onAppInfoClick,children:(0,s.jsx)("span",{className:re("title"),children:(0,K.T)(o)})}),this.renderGameLikeButton()]})})}renderFullscreenIcon(){const{isFullscreenActive:e,getText:t}=this.props,a=!e;return(0,s.jsx)(b.Z,{alt:t("common.open-fullscreen"),className:re("fullscreen-icon",{enable:a}),modifiers:{enable:a,env:"desktop"},type:"fullscreen"})}renderBalance(){const{abt:e,hidePortalCurrency:t}=this.context,{getText:a}=this.props;if(t||(0,D.Sn)(e.flags))return null;const i=(0,r.v_)({on:"new_game_navigation"})?"":"hover";return(0,s.jsx)("div",{className:`${re("action",{balance:!0})} ${re("menu")} menu ${i} pointer`,ref:this.menuAnchorRef,title:a("header.button.balance.text"),children:(0,s.jsx)(w.Z,{isCurrencyColorInverted:!this.isMiddleLayerShown,type:"game"})})}renderGameLikeButton(){return(0,r.v_)({on:"game_likes"})&&this.context.playPageData.gameData?(0,s.jsx)(U,{className:re("game-header-reactions"),game:this.context.playPageData.gameData}):null}renderActions(){const{darkTheme:e,getText:t,isFullscreenActive:a,isMiddleLayerShownInGame:i,isNewNavigation:n}=this.props;return(0,s.jsxs)("div",{className:re("actions"),"data-nosnippet":"true",children:[(0,s.jsx)(y.K,{}),this.renderBalance(),(0,s.jsxs)("div",{className:`${re("action")} ${re("menu")} menu hover pointer`,ref:this.menuAnchorRef,title:t("header.button.menu.text"),onClick:this.onMenuIconClick,children:[(0,s.jsx)("div",{className:re("menu-icon-wrapper",{dotted:this.state.menuDotted}),children:(0,s.jsx)(b.Z,{alt:t("common.menu"),className:re("menu-icon"),type:this.isMiddleLayerShown&&!e?"game-menu-black":"game-menu-white"})}),this.state.menuVisible&&(0,s.jsx)(C.Z,{anchorRef:this.menuAnchorRef,onClose:this.handleMenuClose})]}),this.isFullscreenButtonAvailable()&&(0,s.jsx)("div",{className:`${re("action")} ${re("fullscreen")} hover pointer`,title:t(a?"header.button.exit-fullscreen.text":"header.button.enter-fullscreen.text"),onClick:this.onFullscreenButtonClick,children:this.renderFullscreenIcon()}),!i&&(0,s.jsx)(r.hW,{on:"login_game_header_action",onComponent:(0,s.jsx)(W.T,{className:re("action"),classNameStripeAnimation:"play-game-header-critical-game-module__loginButton--c1B4z stripe-composables-module__stripe-related-header-btn--Fkuei",size:n?40:24})}),(0,s.jsx)(f.Z,{iconClass:re("exit"),mix:`${re("action")} ${re("exit")}`,onClick:this.onExitButtonClick,onEnable:this.isEnableExitButton})]})}checkExitEnabled(){const e=new URLSearchParams(this.props.location.search);this.isExitEnabled="1"===e.get("exit-button")}render(){return this.checkExitEnabled(),(0,s.jsx)("header",{className:re({"catalog-enabled":!1,"exit-enabled":this.isExitEnabled,"fullscreen-enabled":this.props.isFullscreenEnabled,"menu-enabled":!0,"with-adv":this.isAdvStickyBannerEnabled,"middle-layer-enabled":this.isMiddleLayerShown,"middle-layer-light":this.isMiddleLayerShown&&!this.props.darkTheme,hide:!this.state.visible}),children:this.state.visible&&(0,s.jsxs)(s.Fragment,{children:[this.renderLogo(),this.renderHeaderInfo(),this.renderActions()]})})}}const ue=(0,o.E)((0,$.v)((0,u.$j)(function(e){var t;return{advEnabledByPartner:e.advPartnerInfo.advEnabledByPartner,darkTheme:(0,g.Up)(e),getText:e.getText,hasAuth:Boolean(e.userData.login),isFullscreenActive:e.ui.isFullscreenActive,isFullscreenEnabled:e.ui.isFullscreenEnabled,lang:e.lang,isMiddleLayerShownInGame:null==(t=e.middleLayerInGameData)?void 0:t.show,userData:e.userData}})(he)))},34816:(e,t,a)=>{a.d(t,{Z:()=>h});var s=a(57627);const i=a(74578).Z;var n=a(77314),o=Object.defineProperty,r=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,c=Object.prototype.propertyIsEnumerable,d=(e,t,a)=>t in e?o(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a;const h=e=>{const{abt:{flags:t}}=(0,n.b)(),o=t.new_game_desktop_header?i:a(57496).Z;return(0,s.jsx)(o,((e,t)=>{for(var a in t||(t={}))l.call(t,a)&&d(e,a,t[a]);if(r)for(var a of r(t))c.call(t,a)&&d(e,a,t[a]);return e})({},e))}},34095:(e,t,a)=>{a.d(t,{P:()=>me});var s=a(57627),i=a(24051),n=a(4545),o=a(55031),r=a(68257),l=a(89131),c=a(36329),d=a(45005),h=a(63904),u=a.n(h),p=a(30928),m=a(20958),g=a(96533),v=a(50678),w=a(87363),f=a(34057),y=a(16943),b=Object.defineProperty;const x=u().with("game-categories");class C extends w.Component{render(){const{categoryDataMappedByID:e}=this.context,{categoryIDs:t,mix:a="",withLink:i=!0,withIcon:n=!0}=this.props;if(t)return(0,s.jsx)("ul",{className:`${x()} ${a}`,children:t.map(t=>{const a=e[t];return a?(0,s.jsx)("li",{className:x("category"),children:(0,s.jsx)(f.Z,{name:a.name,title:a.title,type:y.q.CLEAR,withIcon:n,withLink:i})},a.name):null})})}}((e,t,a)=>{t in e?b(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a})(C,"contextType"+"",v.Z);const _=C;var P=a(73146),S=a(47018),I=a(18449),k=a(55990),E=a(55854),j=a(13466),A=a(38225),L=a(77314),D=a(39138),M=a(45310);const N=u().with("play-guard-dialog"),T=({onAuthButtonClick:e})=>{var t;const a=(0,D.T)(),{playPageData:{gameSettings:i}}=(0,L.b)(),n=(0,A.C)(e=>Boolean(e.userData.login));return(0,M.I)()?null:!n&&Boolean(null==(t=i.features)?void 0:t.user_data_required)?(0,s.jsxs)("div",{className:N("authorize"),children:[(0,s.jsx)("div",{className:N("authorize-description"),children:a("guard.player.auth.description")}),(0,s.jsx)(c.z,{"data-guard-auth":"true","data-testid":"play-guard-authorize-button",size:32,type:"submit",view:"secondary",onClick:e,children:a("common.login")})]}):null},O=({children:e,className:t,onClick:a})=>(0,s.jsx)(c.z,{className:t,"data-guard-accept":"play_button",size:40,type:"submit",view:"primary",onClick:a,children:e});var Z=a(46084),R=a(73520),B=a(78825),F=a(71675),G=a(70931),U=a(4522),W=a(87343);function $(e){const t=function(e){let t=1;for(let a=1e3;a>1;a/=10)if(e>=a){t=a;break}return t}(e);return Math.floor(e/t)*t}function H(e){const t=$(e);let a="";try{a=new Intl.NumberFormat("ru-RU").format(t)}catch(e){a=function(e){let t=`${e}`,a="0";for(;t.length>0;){const e=t.slice(-3);t=t.slice(0,-3),a=a?`${e}Â ${a}`:e}return a}(t)}return t>10&&(a+="+"),a}var V=a(74516),q=a(17034),z=a(94365),K=a(55222),X=a(72895),Y=a(26624),J=a(29513),Q=a(60617),ee=a(65745),te=a(34647),ae=a(50337),se=Object.defineProperty,ie=Object.defineProperties,ne=Object.getOwnPropertyDescriptors,oe=Object.getOwnPropertySymbols,re=Object.prototype.hasOwnProperty,le=Object.prototype.propertyIsEnumerable,ce=(e,t,a)=>t in e?se(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,de=(e,t,a)=>(ce(e,"symbol"!=typeof t?t+"":t,a),a);a(51936);const he=u().with("play-guard-dialog");he("header-cancel-link"),he("permission-checkbox"),he("apply-button");class ue extends v.P{constructor(){super(...arguments),de(this,"hasMounted",!1),de(this,"aboutGameConversionDataEvents",{isClicked:!1,isRendered:!1}),de(this,"state",{isSimilarGamesEnables:this.isSimilarGamesEnabled()}),de(this,"handleEarlyEvents",()=>{var e;null==(e=window.earlyEvents)||e.messages.forEach(e=>{const{type:t,action:a,data:s}=e;if("guard"===t)switch(a){case"auth":this.auth();break;case"close":this.cancel();break;case"accept":this.apply(s.actionSource)}})}),de(this,"handleFocusOutEvent",e=>{requestAnimationFrame(()=>{if(document.activeElement===(0,F.n)()){window.focus();const t=e.target;t&&"focus"in t&&"function"==typeof t.focus&&t.focus()}})}),de(this,"onAuthButtonClick",()=>{this.auth()}),de(this,"onApplyButtonClick",()=>{this.apply(o.EO.PlayButton)}),de(this,"onExternalClick",e=>{this.props.handleEvent(new CustomEvent("apply",{detail:{actionSource:o.EO.Background}}))}),de(this,"onContentClick",e=>{e.stopPropagation()}),de(this,"onOpenInfoClick",e=>{e.stopPropagation(),this.logOnceAboutGameConversionDataEventsIsClicked(),this.props.handleEvent(new CustomEvent("info")),B.Z.post({type:"promo-bar",action:"hide"})}),de(this,"apply",e=>{this.props.handleEvent(new CustomEvent("apply",{detail:{actionSource:e}}))}),de(this,"auth",()=>{this.props.handleEvent(new CustomEvent("auth"))}),de(this,"cancel",()=>{this.props.handleEvent(new CustomEvent("cancel"))})}componentDidMount(){var e,t;this.hasMounted=!0,window.focus(),window.addEventListener("focusout",this.handleFocusOutEvent),this.setState((e=((e,t)=>{for(var a in t||(t={}))re.call(t,a)&&ce(e,a,t[a]);if(oe)for(var a of oe(t))le.call(t,a)&&ce(e,a,t[a]);return e})({},this.state),t={isSimilarGamesEnables:this.isSimilarGamesEnabled()},ie(e,ne(t)))),this.handleEarlyEvents()}componentDidUpdate(e){if(e.isLoginStripeLargeModalVisible!==this.props.isLoginStripeLargeModalVisible){const e=this.isSimilarGamesEnabled();this.state.isSimilarGamesEnables!==e&&this.setState({isSimilarGamesEnables:e})}}componentWillUnmount(){window.removeEventListener("focusout",this.handleFocusOutEvent)}isSimilarGamesEnabled(){const{abt:{flags:e},playPageData:t,isDistGame:a}=this.context,{location:s,isLoginStripeLargeModalVisible:i}=this.props;return(0,Z._Z)({appId:t.gameInfo.appId,hasMounted:this.hasMounted,isDistGame:a,isLoginStripeVisible:i,locationHash:s.hash,locationSearch:s.search,showExceptNavigationFromPlayedGames:(0,Q.tQ)(e),showOnRedirectFromCatalog:(0,Q.Fe)(e)})}isAdvStickyBannerEnabled(){const{settings:e}=this.context.playPageData.gameData||{},{adv:t}=(0,G.Lf)(e);return this.context.playPageData.isAdvStickyBannerEnabled&&Boolean(t)}get texts(){const{getText:e}=this.props,{gamesLogoUrlText:t,gamesLogoUrlYandexName:a,verticalName:s}=this.props.vertical;return{aboutGameText:e(`guard.about-game.vertical-${s}`),commonPlayButtonText:e(`common.play.vertical-${s}`),gamesLogoUrlText:t===ee.CF.WEBAPPS_CATEGORY_SERVICE_NAME?e("common.service.app_name"):e("common.service.short_name"),gamesLogoUrlYandexName:a,legalText:e(`guard.legal.text.vertical-${s}`),serviceLogoIconType:`logo-${s}`}}get gameData(){var e,t;const{getText:a}=this.props,{gameInfo:s,gameSettings:i,gameData:n}=this.context.playPageData,o=s.hasWebAppsCategory?"guard.users.count.text":"guard.players.count.text",r=s.playersCount?a(o,{number:$(s.playersCount)}):void 0,l=s.hasWebAppsCategory?a("game.rating.users.new"):a("game.rating.new"),c=(0,q.R)(this.context.isSlowCountry)?this.context.cdnUrl:void 0;return{ageRating:null==(e=i.features)?void 0:e.age_rating,hasWebAppsCategory:s.hasWebAppsCategory,icon:(0,V.kM)(s.iconUrl,c),playersCount:s.playersCount?H(s.playersCount):void 0,playersCountText:r,gameQualityScore:s.gameQualityScore,publisher:(0,W.T)(s.publisher.name),rating:s.rating,ratingText:l,media:(null==n?void 0:n.media)||{},title:(0,W.T)(s.title),userDataRequired:Boolean(null==(t=i.features)?void 0:t.user_data_required),categories:s.categoryNames,categoriesIDs:(null==n?void 0:n.categoryIDs)||[]}}renderCancelButton(){return(0,s.jsx)(c.z,{"aria-label":this.props.getText("common.cancel"),className:(0,U.E)(he("header-cancel-link"),"games-link"),"data-guard-close":"true",size:24,view:"empty",onClick:this.cancel,children:this.props.getText("common.cancel")})}renderHeader(){const{baseUrl:e,referrer:t,tld:a,isPWA:i,oneTabPWA:o}=this.context,{getText:l,vertical:{verticalCategory:c,verticalName:d}}=this.props,h=c?(0,te.QG)(this.context,{name:c}):"/",u=(0,z.Px)({search:"utm_source=game_guard_logo",params:{[J.cB]:i?"1":"",[J.Vw]:(0,X.sD)(t)?t:""}}),p=(0,Q.Ly)()?(0,Y.x)(this.props.preferredHome,this.context.pathLang):"/",m="/"===h?p:h,g=(0,r.E)({baseUrl:e,path:`${m}${u?`${u}`:""}`,lang:this.context.pathLang,languages:(0,n.getDomainConfig)().languages,tld:a});return(0,s.jsxs)("div",{className:he("header"),children:[(0,s.jsx)("span",{className:he("header-logo"),children:(0,s.jsx)(E.Kk,{className:he("header-logo-link"),href:g,tabIndex:-1,target:(0,K.AO)({oneTabPWA:o}),title:l(`common.service.name.vertical-${d}`),children:(0,s.jsx)(j.Z,{type:ee.q7.GUARD})})}),this.renderCancelButton()]})}renderRating(){return(0,s.jsxs)("div",{className:he("description-players"),children:[this.gameData.gameQualityScore&&(0,s.jsx)(S.Z,{value:this.gameData.gameQualityScore}),(0,s.jsx)(I.Z,{hasWebAppsCategory:this.gameData.hasWebAppsCategory,rating:this.gameData.rating,useNewText:!0})]})}renderDescription(){const{isSlowCountry:e}=this.context,{categories:t,categoriesIDs:a,media:i,publisher:n,title:o,ageRating:r}=this.gameData,{appId:l}=this.context.playPageData.gameInfo;return(0,s.jsxs)("div",{className:he("description"),children:[(0,s.jsx)(P.Z,{alt:o,appID:l,canUseLocalCdn:!0,loading:"eager",media:i,mix:he("description-icon",{low:e}),size:e?V.KL.default84x84:V.KL.pjpg128x128}),(0,s.jsx)("div",{className:he("description-details"),children:(0,s.jsxs)("div",{className:he("description-details-header"),children:[(0,s.jsxs)("div",{className:he("description-title-wrapper"),children:[(0,s.jsx)("h1",{className:he("description-title"),children:o}),r&&(0,s.jsx)(d.Wd,{className:he("description-ageRating"),"data-testid":"play-guard-age-tag",variant:ae.Ft[r],children:r})]}),(0,s.jsx)("div",{className:he("description-publisher"),children:n}),(0,s.jsx)(_,{categoriesNames:t,categoryIDs:a,mix:he("categories")})]})})]})}logOnceAboutGameConversionDataEventsIsRendered(){if(this.aboutGameConversionDataEvents.isRendered)return;this.aboutGameConversionDataEvents.isRendered=!0;const e=this.context.playPageData.gameInfo.appId;window.clickdaemonLog(R.C.CONVERSION,{item:"game_page_guard_learn_more_render",app_id:e,game_id:e})}logOnceAboutGameConversionDataEventsIsClicked(){if(this.aboutGameConversionDataEvents.isClicked)return;this.aboutGameConversionDataEvents.isClicked=!0;const e=this.context.playPageData.gameInfo.appId;window.clickdaemonLog(R.C.CONVERSION,{item:"game_page_guard_learn_more_click",app_id:e,game_id:e})}renderApply(){return(0,s.jsx)("div",{className:he("apply"),title:this.texts.commonPlayButtonText,children:(0,s.jsx)(O,{className:he("apply-button"),onClick:this.onApplyButtonClick,children:this.texts.commonPlayButtonText})})}renderOpenInfo(){{"undefined"!=typeof window&&this.logOnceAboutGameConversionDataEventsIsRendered();const e=`${this.texts.aboutGameText}: ${this.gameData.title}`;return(0,s.jsxs)("button",{"aria-label":e,className:`${he("open-info")} games-link`,onClick:this.onOpenInfoClick,children:[(0,s.jsx)(k.Z,{type:"info"}),this.texts.aboutGameText]})}}render(){const e=this.state.isSimilarGamesEnables&&!this.props.isFullscreenActive;return(0,s.jsxs)("div",{className:he({"with-blur":!0,"with-adv":this.isAdvStickyBannerEnabled(),"with-similar":e,"with-stripe-large":this.props.isLoginStripeLargeModalVisible,hidden:this.props.hidden}),onClick:this.onExternalClick,children:[(0,s.jsxs)("div",{"aria-modal":"true",className:he("content"),role:"dialog",onClick:this.onContentClick,children:[this.renderHeader(),this.renderDescription(),this.renderRating(),(0,s.jsx)(T,{onAuthButtonClick:this.onAuthButtonClick}),this.renderApply()]}),this.renderOpenInfo()]})}}const pe=(0,l.E)((0,p.$j)(function(e){return{darkTheme:(0,g.Up)(e),getText:e.getText,hasAuth:Boolean(e.userData.login),isFullscreenActive:e.ui.isFullscreenActive,isSimilarGamesLoading:e.similarGamesLoading,isLoginStripeLargeModalVisible:e.ui.isLoginStripeLargeModalVisible,lang:e.lang,vertical:e.vertical,preferredHome:(0,m.D)(e)}})(ue));function me(){return(0,s.jsx)(i.u.Consumer,{children:e=>e.isNeedToShow?(0,s.jsx)(pe,{handleEvent:e.handleEvent,hidden:e.isHidden}):null})}},24051:(e,t,a)=>{a.d(t,{u:()=>s});const s=(0,a(87363).createContext)({handleEvent:e=>{throw new Error("PlayGuardContext is not initialized")},isHidden:!1,isNeedToShow:!1})},41353:(e,t,a)=>{a.d(t,{Z:()=>C});var s=a(57627),i=a(69278),n=a(89131),o=a(30928),r=a(89957),l=a(81092),c=a(59962),d=a(50678),h=a(24051),u=a(78825),p=a(93582),m=a(61712),g=a(28250),v=a(87125),w=a(33376),f=Object.defineProperty,y=(e,t,a)=>(((e,t,a)=>{t in e?f(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a})(e,"symbol"!=typeof t?t+"":t,a),a);const b=(0,v.M$)("PlayGuard",v.XG.Popup);class x extends d.P{constructor(){super(...arguments),y(this,"state",{show:this.isNeedToShow(),hidden:!0}),y(this,"wasShowed",!this.state.show),y(this,"permissionsPromiseWrapper",new i.Z),y(this,"applyPromise"),y(this,"onGuardMessage",(e,t)=>{var a;if("play-guard"!==(null==(a=e.data.data)?void 0:a.source))switch(e.data.action){case"is-guard-enabled":t({data:{result:this.isGuardEnabled}});break;case"get-show-state":t({data:{result:!this.wasShowed}});break;case"get-was-showed":t({data:{result:this.wasShowed}});break;case"apply":if(this.wasShowed)this.permissionsPromiseWrapper.reject();else{const{actionSource:t}=e.data.data;this.apply({actionSource:t})}break;case"show":u.Z.post({type:"promo-bar",action:"show"}),u.Z.post({type:"guard",action:"state-changed",data:{state:"up"}});break;case"focus":this.wasShowed?(0,r.D)():window.focus()}}),y(this,"handleEvent",e=>{switch(e.type){case"apply":{const{actionSource:t}=e.detail;this.apply({actionSource:t});break}case"auth":this.auth();break;case"cancel":this.cancel();break;case"info":this.info()}})}componentDidMount(){b("componentDidMount",this.state),u.Z.onInternalMessage("guard",this.onGuardMessage,{withHistory:!0}),this.permissionsPromiseWrapper.promise.catch(()=>{});const e=this.isNeedToShow();this.setIsGuardOpened(e),this.wasShowed=!e;const t=e?"show":"hide";this.setState({hidden:!1,show:e},()=>{this.wasShowed&&this.postSetWasShowedAction()}),e&&(u.Z.post({type:"promo-bar",action:"show"}),this.sendParamsWrapper({show:!0})),this.sendParamsWrapper({initialStatus:t}),u.Z.post({type:"guard",action:"init"}),u.Z.post({type:"guard",action:"state-changed",data:{state:"show"===t?"up":"play"}})}componentWillUnmount(){b("componentWillUnmount"),u.Z.offInternalMessage("guard",this.onGuardMessage)}setIsGuardOpened(e){this.props.dispatch((0,l.lt)(e))}get isGuardEnabled(){const{location:e}=this.props,{abt:t,playPageData:a,referrerClid:s}=this.context,{gameData:i}=a,{flags:n}=t,o=(0,p.p)(i);return(0,p.Z)({clid:s,flags:n,isConfirmedGuard:o,location:e})}isNeedToShow(){return this.isGuardEnabled}apply({actionSource:e}){this.applyPromise||(this.applyPromise=Promise.race([(0,g.D)(5e3).then(()=>this.permissionsPromiseWrapper.reject()),new Promise((t,a)=>{this.sendScope().then(()=>{this.permissionsPromiseWrapper.reject(),(0,m.U4)({},{borrowParams:{personal:{showed:!1,value:!1}}}),(0,m.NF)({},w.Ji.GUARD_APPLY);const{appId:a}=this.context.playPageData.gameInfo;a&&(0,m.SX)("view_item",{send_to:"AW-10952943694",value:0,items:[{id:a,location_id:0,google_business_vertical:"custom"}]}),u.Z.post({type:"guard",action:"apply",data:{source:"play-guard"}}),u.Z.post({type:"guard",action:"state-changed",data:{state:"play"}}),this.sendParamsWrapper({apply:e}),u.Z.post({type:"promo-bar",action:"remove"}),t(void 0)})})]).then(()=>this.close()).finally(()=>this.applyPromise=void 0))}auth(){this.sendParamsWrapper({auth:!0}),u.Z.post({type:"auth",action:"auth-dialog-open",data:{initializer:"guard"}})}cancel(){const{referrer:e}=this.context;this.sendParamsWrapper({cancel:!0}),u.Z.post({type:"guard",action:"cancel",data:e?{referrer:e}:{}})}close(){this.wasShowed=!0,this.setIsGuardOpened(!1),this.setState({show:!1},()=>this.postSetWasShowedAction()),(0,r.D)(),u.Z.post({type:"guard",action:"closed"})}info(){this.sendParamsWrapper({info:!0}),u.Z.post({type:"guard",action:"info"}),u.Z.post({type:"guard",action:"state-changed",data:{state:"info"}}),u.Z.post({type:"promo-bar",action:"hide"})}sendScope(){const{appId:e,isDraft:t}=this.context.playPageData.gameInfo;return this.props.api.sendPrivateInfo({appId:Number(e),guard:!0,draft:t})}sendParamsWrapper(e){(0,m.U4)({},{borrowParams:{guard:e}})}postSetWasShowedAction(){u.Z.post({type:"guard",action:"set-was-showed",data:{result:!0}})}render(){return(0,s.jsx)(h.u.Provider,{value:{handleEvent:this.handleEvent,isHidden:this.state.hidden,isNeedToShow:this.state.show},children:this.props.children})}}const C=(0,n.E)((0,o.$j)(function(e){return{api:(0,c.Z)(e.apiData)}})(x))},46084:(e,t,a)=>{a.d(t,{_Z:()=>_,ii:()=>P,kr:()=>x,xG:()=>b});var s=a(67748),i=a.n(s),n=a(79092),o=a(94365),r=a(7323),l=a(45252),c=Object.defineProperty,d=Object.defineProperties,h=Object.getOwnPropertyDescriptors,u=Object.getOwnPropertySymbols,p=Object.prototype.hasOwnProperty,m=Object.prototype.propertyIsEnumerable,g=(e,t,a)=>t in e?c(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,v=(e,t)=>{for(var a in t||(t={}))p.call(t,a)&&g(e,a,t[a]);if(u)for(var a of u(t))m.call(t,a)&&g(e,a,t[a]);return e},w=(e,t)=>d(e,h(t));const f=e=>{let t;try{t=JSON.parse(e)}catch(e){t=[]}return Array.isArray(t)?t:[]},y=(e,t)=>{const a=Array.isArray(e)?e:f(e);t&&a.push(t),(0,r.Ur)(l.VM,JSON.stringify(a))};function b(e){const t=(0,r.dq)(l.VM);t.wasError||!t.value?(0,r.Ur)(l.VM,JSON.stringify([e])):y(t.value,e)}function x(e,t){return 0===t.length?t:t.length>e?t=t.slice(0,e):(t.length<e&&(t=[...Array(Math.ceil(e/t.length))].reduce((e,a,s)=>e.concat(t.map((e,a)=>w(v({},e),{appID:e.appID+s,title:e.title+` (${s*t.length+a+1})`}))),[]).slice(0,e)),t)}const C=["played","user_profile_recent_games"];function _({appId:e,hasMounted:t,inGamePage:a,isDistGame:s,isLoginStripeVisible:c,locationHash:d,locationSearch:h,showExceptNavigationFromPlayedGames:u,showOnRedirectFromCatalog:p}){if(s||c)return!1;const m=new URLSearchParams(h);if("distrib"===m.get("utm_source")||m.has("clid"))return!1;if(a)return!0;if(!t)return!0;if((0,n.X)())return!1;if(u){const e=i().parse(d);if(e.pos&&"string"==typeof e.pos)try{if(C.includes(JSON.parse(e.pos).listType))return!1}catch(e){}}else if(!p&&(0,o.Oo)())return!1;const g=(0,r.dq)(l.VM);return!(!g.wasError&&g.value&&f(g.value).includes(e))}function P(){"undefined"!=typeof document&&document.body.classList.contains("with-similar-games")&&document.body.classList.remove("with-similar-games")}},18158:(e,t,a)=>{a.d(t,{Z:()=>f});var s=a(57627),i=a(57233),n=a(27987),o=a(63904),r=a.n(o),l=a(87363),c=a(30928),d=a(50678),h=a(70619);a(69729);var u=a(29513),p=Object.defineProperty,m=(e,t,a)=>(((e,t,a)=>{t in e?p(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a})(e,"symbol"!=typeof t?t+"":t,a),a);const g=r().with("share-popup"),v="bottom";class w extends l.Component{constructor(e){super(e),m(this,"nativeShare",false),m(this,"onClose",()=>{var e,t;null==(t=(e=this.props).onClose)||t.call(e)}),this.state={loadingState:"loading"}}componentDidUpdate(e){if(!e.visible&&this.props.visible){if(this.nativeShare)return this.props.shareUrl,this.props.shareTitle,this.props.shareTitle,void Promise.resolve();this.loadContent()}}loadContent(){(0,h.x)({id:"yashare2-script",src:"https://yastatic.net/share2/share.js"}).then(()=>{this.setState({loadingState:"loaded"},()=>{var e,t;null==(t=null==(e=window.Ya)?void 0:e.share2)||t.call(e,this.props.elementId,{content:{url:this.props.shareUrl}})})}).catch(()=>{this.setState({loadingState:"error"})})}render(){if(this.nativeShare)return null;const{boundary:e={current:document.body},elementId:t,direction:a=v,hasTail:o=!0,mainOffset:r,scope:l,shareRef:c,visible:d,getText:h}=this.props,{lang:p}=this.context,m=u.K4.includes(p)?p:"en",w="en"===m?u.gE:u.AI;return(0,s.jsxs)(i.GI,{anchor:c,boundary:e,className:g(),"data-testid":"share-popup-popup",direction:a,keepMounted:!1,mainOffset:r,scope:l,tail:o?(0,s.jsx)(i.Xs,{fillClassName:g("tail")}):void 0,visible:d,onClick:this.onClose,onClose:this.onClose,children:["loading"===this.state.loadingState&&(0,s.jsx)("div",{children:(0,s.jsx)(n.y,{position:"center",size:32,spinning:!0})}),"loaded"===this.state.loadingState&&(0,s.jsx)("div",{"data-color-scheme":"normal","data-copy":"extraItem","data-direction":"vertical","data-lang":m,"data-popup-direction":"bottom","data-popup-position":"inner","data-services":w,"data-shape":"normal","data-size":"m",id:t}),"error"===this.state.loadingState&&(0,s.jsx)("div",{className:g("error-description"),children:h("common.error.fetch")})]})}}m(w,"contextType",d.Z);const f=(0,c.$j)(function(e){return{getText:e.getText}})(w)},98132:(e,t,a)=>{a.d(t,{w:()=>s});var s=(e=>(e.MENU="menu",e.TIMER="timer",e))(s||{})},56044:(e,t,a)=>{a.d(t,{T:()=>p});var s=a(57627),i=a(36329),n=a(87363),o=a(38225),r=a(19694),l=a(28676),c=a(39138),d=a(4522),h=a(10323),u=a(45310);const p=({className:e,classNameStripeAnimation:t,size:a=24})=>{const p=(0,c.T)(),m=(0,o.C)(r.Nl),g=(e=>{const t=(0,n.useRef)(e),a=t.current&&!1===e;return t.current=e,a})(m);return(0,u.I)()||m||null===m?null:(0,s.jsx)(l.s,{passportOrigin:h._4.GamesHeaderAction,children:({login:n,userIsLoggedIn:o})=>o||m?null:(0,s.jsx)("div",{className:(0,d.E)(e,g&&t),children:(0,s.jsx)(i.z,{glowing:"pulsation",rounded:!0,size:a,view:"primary",onClick:n,children:p("common.login")})})})}},74938:(e,t,a)=>{a.d(t,{v:()=>u});var s=a(57627),i=a(38207),n=Object.defineProperty,o=Object.defineProperties,r=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,c=Object.prototype.hasOwnProperty,d=Object.prototype.propertyIsEnumerable,h=(e,t,a)=>t in e?n(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a;const u=(e,t="other")=>a=>{const n=(0,i.ff)({reason:t});return(0,s.jsx)(e,(u=((e,t)=>{for(var a in t||(t={}))c.call(t,a)&&h(e,a,t[a]);if(l)for(var a of l(t))d.call(t,a)&&h(e,a,t[a]);return e})({},a),o(u,r({gameControl:n}))));var u}},15383:(e,t,a)=>{a.d(t,{T:()=>o});var s=a(38225),i=a(39138);const n=e=>e.vertical.verticalName,o=()=>{const e=(0,s.C)(n);return(0,i.T)()(`common.play.vertical-${e}`)}},40815:(e,t,a)=>{a.d(t,{x:()=>re});var s=a(57627),i=a(4545),n=a(43774),o=a(87363),r=a.n(o),l=a(16705),c=a(38225);const d=a(8855).J;var h=a(88866),u=a(78825);const p=()=>{const[e,t]=(0,o.useState)(""),a=(0,o.useCallback)(e=>{"show"===e.data.action&&t(e.data.data.message)},[]);return(0,o.useEffect)(()=>(u.Z.onInternalMessage("message-box",a),()=>{u.Z.offInternalMessage("message-box",a)}),[a]),e?(0,s.jsx)(h.Z,{autohide:!0,children:e}):null},m=a(59542).Z;var g=a(85294),v=a(61265);let w=a(96497)._;const f=(0,o.memo)(({onClose:e,onPromocodeChange:t,promocode:a})=>(0,s.jsx)(w,{promocode:a,onClose:e,onPromocodeChange:t}));var y=a(90788),b=a(73520),x=a(77314),C=a(76753);const _=()=>{const{registerPopup:e,isShown:t,hidePopup:a,showPopup:i}=(0,o.useContext)(v.OM),{promocodeQueryInput:n}=(0,x.b)(),[r,l]=(0,o.useState)(n||""),c=(0,o.useCallback)(e=>l(e.target.value),[]),d=(0,o.useRef)(Boolean(r));(0,C.q)(()=>{var t;e({name:y.v1,weight:50,showCondition:()=>!1}),r&&(i({name:y.v1,weight:50}),null==(t=window.clickdaemonLog)||t.call(window,b.C.PROMOCODES_MODAL_OPEN,{trigger:"queryParam"}))});const h=(0,o.useCallback)(()=>{d.current=!1,a(y.v1)},[a]);return t(y.v1)||d.current?(0,s.jsx)(f,{promocode:r,onClose:h,onPromocodeChange:c}):null};var P=a(12222),S=a(25135),I=a(65751),k=a(12536),E=a(45682),j=a(55031),A=a(89131),L=a(66287),D=a(30928),M=a(63904),N=a.n(M),T=(Object.defineProperty,(e=>(e.FULL="full",e.HIDDEN="hidden",e.MOVING="moving",e.SMALL="small",e))(T||{}));N().with("app-drawer");var O=a(50678),Z=a(55854),R=a(49808),B=a(93582),F=a(61916),G=a(68755),U=a(60617),W=a(50337),$=a(61712),H=a(55222),V=a(72895),q=a(29513),z=a(87125),K=a(99251),X=a(85031),Y=a(26592);const J=a(84490).Z;var Q=Object.defineProperty,ee=(e,t,a)=>(((e,t,a)=>{t in e?Q(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a})(e,"symbol"!=typeof t?t+"":t,a),a);const te=(0,z.M$)("gamePage",z.XG.Dev);a(83858);const ae=["document-events","guard"];class se extends O.P{constructor(){super(...arguments),ee(this,"feedbackTitleElement"),ee(this,"gameInstructionElement"),ee(this,"pageStartRef",r().createRef()),ee(this,"withInfo",-1!==this.props.location.search.indexOf("info=true")),ee(this,"needToShowLeaderboard",(()=>{const{search:e,hash:t}=this.props.location;return`${e}#${t}`.includes("leaderboard")})()),ee(this,"shouldRenderContent",Boolean((0,X.P)().isSearchCrawler)),ee(this,"state",{showInfo:this.getInitGuardState(),showGuard:this.getInitGuardState(),drawerStatus:this.shouldRenderContent?T.FULL:T.SMALL,hiddenControls:this.getInitHiddenControls(),hiddenImages:!0,hiddenLazyElements:!0,hiddenVideo:!0,playerError:!1,scrollTop:0,scrollToLeaderboard:!1}),ee(this,"handleClose",()=>{const{hiddenControls:e,showInfo:t}=this.state;if(!this.withInfo||e){if(e){if(t&&!(0,H.PK)()){const{hash:e,href:t}=(0,K.e)();if("#info"===e){const e=t.replace("#info",""),a=window.history.state;window.parent.history.pushState(a,"",e)}}}else u.Z.post({type:"guard",action:"show"});this.setState({hiddenVideo:!0,scrollToLeaderboard:!1,showInfo:!1})}else this.handleBack()}),ee(this,"handleBackgroundClick",()=>{this.handleApply(j.EO.Background)}),ee(this,"handleCloseButton",()=>{this.handleApply(j.EO.CloseButton)}),ee(this,"handleDrawerClose",()=>{this.handleApply(j.EO.DrawerSwipe)}),ee(this,"handleAuth",()=>{u.Z.post({type:"auth",action:"auth-dialog-open",data:{initializer:"app-page"}}),(0,$.U4)({},{action:"auth"})}),ee(this,"handleBack",()=>{const{hiddenControls:e,showInfo:t}=this.state;t&&(e||this.context.oneTabPWA)?this.backViaHistory():((0,$.U4)({},{action:"back-to-catalog"}),document.documentElement.classList.remove("with-player"),this.exitFullscreen(),this.canUseWindowClose()?window.close():this.backViaWindowOpen())}),ee(this,"handlePlayButton",()=>{this.handleApply(j.EO.PlayButton)}),ee(this,"handleUpdateScrollTop",e=>{this.setState({scrollTop:e})}),ee(this,"feedbackRef",e=>{this.feedbackTitleElement=e}),ee(this,"gameInstructionRef",e=>{this.gameInstructionElement=e}),ee(this,"handleBackButton",e=>{const{hiddenControls:t}=this.state;!e.state&&t&&this.hideInfo()}),ee(this,"handleEarlyEvents",()=>{var e;null==(e=window.earlyEvents)||e.messages.forEach(e=>{const{type:t,action:a,data:s}=e;if("guard"===t)switch(a){case"auth":this.handleAuth();break;case"close":this.handleBack();break;case"accept":this.handleApply(s.actionSource)}}),document.documentElement.classList.remove("without-guard")}),ee(this,"changeDrawerStatus",e=>{this.setState({drawerStatus:e}),e===T.FULL&&(this.setState({hiddenLazyElements:!1,hiddenVideo:!1}),u.Z.post({type:"promo-bar",action:"remove"}))}),ee(this,"handleVisibilityChange",()=>{"visible"===document.visibilityState&&this.requestFullscreen()}),ee(this,"requestFullscreen",()=>{var e;const{game:t}=this.props,a=(0,F.KT)();(0,k.Me)(a,k.QQ.ByteApp)||L.default.requestFullscreenAndLockOrientation(null==(e=t.features)?void 0:e.orientation)}),ee(this,"onAllMessages",e=>{const{type:t,action:a,data:s}=e.data,{platform:i}=this.context,{isIOS:n}=(0,W.AK)(i);switch(t){case"document-events":switch(a){case"redirect":window.location.href=s.href;break;case"back":this.handleBack();break;case"show-info":case"show-review":case"show-instruction":case"show-leaderboard":this.setState({hiddenImages:!1,showInfo:!0}),this.setRenderTriggered(),this.sendNotificationToSelfWindow(),this.state.hiddenControls&&!(0,H.PK)()&&window.parent.history.pushState("info","","#info"),requestAnimationFrame(()=>{this.changeDrawerStatus(T.FULL),setTimeout(()=>{var e,t,s;switch(a){case"show-review":this.scrollAfterLeaderboardFetching("review");break;case"show-instruction":null==(e=this.gameInstructionElement)||e.scrollIntoView({behavior:"smooth"});break;case"show-leaderboard":this.scrollAfterLeaderboardFetching("leaderboard");break;case"show-info":null==(s=null==(t=this.pageStartRef.current)?void 0:t.parentElement)||s.scrollTo({behavior:"smooth",top:0})}n&&setTimeout(()=>{window.scrollTo(0,0)},500)},200)}),(0,$.U4)({},{action:a})}break;case"guard":switch(a){case"cancel":this.handleBack();break;case"info":this.setState({showInfo:!0,hiddenControls:!1,hiddenImages:!1,hiddenLazyElements:!1,hiddenVideo:!1}),this.setRenderTriggered(),this.sendNotificationToSelfWindow();break;case"apply":this.setState({hiddenControls:!0});break;case"init":this.setState({hiddenControls:!1})}}})}handleApply(e){const{showInfo:t,hiddenControls:a,playerError:s}=this.state;s||(this.props.isMiddleLayerInGame&&e===j.EO.Background?this.hideInfo():((!a||this.props.isMiddleLayerInGame&&e===j.EO.PlayButton)&&u.Z.post({type:"guard",action:"apply",data:{actionSource:e}}),this.hideInfo(),this.setState({showGuard:!1}),t&&a&&((0,H.PK)()||"#info"===(0,K.e)().hash&&history.back(),(0,$.U4)({},{action:"hide-info"})),requestAnimationFrame(()=>{window.scrollTo(0,0),this.passFocusToFrame()})))}passFocusToFrame(){u.Z.hasChild()&&u.Z.postToChild((0,E.$m)())}backViaHistory(){this.context.oneTabPWA||this.setState({showInfo:!1}),history.back(),(0,$.U4)({},{action:"close-info"})}backViaWindowOpen(){const{baseUrlWithLangPath:e,hidePaymentsAndCurrency:t,isGamesLiteApp:a,isPWA:s,oneTabPWA:i,pfid:n,referrer:o}=this.context,r=I.parse((0,K.e)().search.slice(1));o&&(0,V.sD)(o)&&(r[q.Vw]=o),a&&(r.utm_source="close_button"),t&&(r[q.o1]="1"),s&&(r[q.cB]="1"),n&&(r[q.om]=n);const l=I.stringify(r),{href:c,origin:d}=(0,K.e)();let h=`${d}${e}${l.length?`/?${l}`:""}`;h=(0,Z.ky)(h,{currentLocation:c}),window.open(h,i?"_parent":"_self")}canUseWindowClose(){const{isGamesLiteApp:e,oneTabPWA:t,uatraits:a}=this.context;return!e&&(!t||!(0,Y.g)(a))&&(!!window.opener||window.history.length>1&&(0,n.v_)({on:"open_game_inp.link_click"}))}componentDidMount(){u.Z.onAllMessages(ae,this.onAllMessages,{withHistory:!0}),this.handleEarlyEvents(),this.initInfoWindow()}componentDidUpdate(e,t){t.showInfo===this.state.showInfo||this.state.showInfo||u.Z.post({type:"document-events",action:"hide-info"})}componentWillUnmount(){this.exitFullscreen(),u.Z.offAllMessages(ae,this.onAllMessages),document.removeEventListener("visibilitychange",this.handleVisibilityChange),window.removeEventListener("popstate",this.handleBackButton)}exitFullscreen(){}sendNotificationToSelfWindow(){u.Z.post({action:"open",type:"app-info"})}hideInfo(){this.changeDrawerStatus(T.HIDDEN),setTimeout(()=>{this.setState({showInfo:!1,hiddenControls:!0,scrollToLeaderboard:!1,hiddenVideo:!0})},200)}isGuardEnabled(){const{abt:{flags:e},platform:t,playPageData:{gameData:a},referrerClid:s}=this.context;return!(({flags:e,isConfirmedGuard:t,platform:a,referrerClid:s,search:i})=>{if(t||(0,k.Me)(s,k.QQ.YangoGo)||(0,U.bM)(e))return!0;if(I.parse("?"===i.charAt(0)?i.slice(1):i)[G.U])return!0;const n=(0,W.AK)(a);return!!(n.isStandalone&&n.isAndroidStandalone&&(0,U.Iv)(e))})({flags:e,isConfirmedGuard:(0,B.p)(a),platform:t,referrerClid:s,search:this.props.location.search})}getInitHiddenControls(){return!this.isGuardEnabled()||this.props.isMiddleLayerInGame}getInitGuardState(){return!(this.props.isMiddleLayerInGame&&!this.shouldRenderContent||!(this.shouldRenderContent||this.withInfo||this.props.location.search.includes("leaderboard")))}initInfoWindow(){var e,t;const a=this.isGuardEnabled();this.shouldRenderContent&&(requestAnimationFrame(()=>{this.changeDrawerStatus(T.FULL)}),this.setState({hiddenImages:!1,showInfo:!0,showGuard:!0,hiddenControls:!a})),this.withInfo||this.needToShowLeaderboard?(this.setState({hiddenControls:!1,hiddenImages:!1,showGuard:!0,showInfo:!0}),this.shouldRenderContent||requestAnimationFrame(()=>{this.changeDrawerStatus(this.withInfo?T.FULL:T.SMALL)})):this.shouldRenderContent||(this.changeDrawerStatus(T.HIDDEN),this.setState({showInfo:!1,showGuard:!1,hiddenControls:!a})),this.props.isMiddleLayerInGame&&!this.shouldRenderContent&&this.setState({showInfo:!1,hiddenControls:!0}),window.addEventListener("popstate",this.handleBackButton,!1),u.Z.post({type:"guard",action:"load",data:{startTime:null==(t=null==(e=window.performance)?void 0:e.timing)?void 0:t.navigationStart}})}scrollAfterLeaderboardFetching(e,t=0){const{leaderboardsLoaded:a}=this.props,{playPageData:s}=this.context;(0,R.X)(s)&&!a&&t<5?setTimeout(()=>{this.scrollAfterLeaderboardFetching(e,t+1)},100):requestAnimationFrame(()=>{var t;switch(e){case"leaderboard":this.setState({scrollToLeaderboard:!0});break;case"review":null==(t=this.feedbackTitleElement)||t.scrollIntoView({behavior:"smooth"})}})}setRenderTriggered(){this.shouldRenderContent=!0}render(){return te("game-page render"),this.shouldRenderContent?(te("game-page render desktop"),(0,s.jsx)(J,{game:this.props.game,handlers:{handleBack:this.handleBack,handleClose:this.handleClose,handlePlayButton:this.handlePlayButton,handleAuth:this.handleAuth,handleBackgroundClick:this.handleBackgroundClick},refs:{pageStartRef:this.pageStartRef,feedbackRef:this.feedbackRef,gameInstructionRef:this.gameInstructionRef},state:this.state})):null}}const ie=(0,A.E)((0,D.$j)(function(e){var t,a,s;return{isMiddleLayerInGame:Boolean(null==(t=e.middleLayerInGameData)?void 0:t.show),leaderboardsLoaded:(null==(a=e.leaderboards)?void 0:a.main.loaded)&&(null==(s=e.leaderboards)?void 0:s.friends.loaded)}})(se));var ne=a(95663),oe=a(27390);const re=(0,o.forwardRef)(({isIOSLimitedFsAvailable:e,onDrawerVisibleChange:t},a)=>{var o,r;const{playPageData:{gameData:h,gameInfo:u},abt:{flags:v}}=(0,x.b)(),{isSearchCrawler:w}=(0,X.P)(),{promocodesDisabled:f}=(0,i.getDomainConfig)(),y=(0,c.C)(e=>e.userData.isAccountCompletionAvailable),b=(0,ne.f)(),C=b&&(0,U.RM)(v,oe.Z.userActivityPopup),I=(0,c.C)(e=>Boolean(e.userData.uid));return(0,s.jsxs)(s.Fragment,{children:[(null==h?void 0:h.appID)?(0,s.jsx)(ie,{game:h}):null,C&&(0,s.jsx)(P.Z,{}),(0,s.jsx)("div",{className:"gdpr-overlay"}),b&&!w&&y&&(0,s.jsx)(m,{}),Boolean(e)&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(l.ql,{children:(0,s.jsx)("html",{"data-limited-fs-available":"yes"})}),(0,s.jsx)("div",{className:"limited-fs-checker",ref:a})]}),!f&&(0,s.jsx)(_,{}),I&&(0,s.jsx)(n.hW,{on:"game_gifts_modal",onComponent:(0,s.jsx)(d,{})}),(0,s.jsx)(p,{}),(0,s.jsx)(S.l,{gameInfo:u?{category:null==(o=u.categoryNames)?void 0:o[0],title:u.title,id:u.appId,isDraft:u.isDraft,publisherName:null==(r=u.publisher)?void 0:r.name}:void 0}),(0,s.jsx)(g.Z,{onDialogChange:t})]})})},23111:(e,t,a)=>{a.d(t,{T:()=>nt});var s=a(57627),i=a(4545),n=a(87363),o=a(77314),r=a(40497),l=a(60362),c=a(49513),d=a(78825),h=a(20966),u=a(87125),p=Object.defineProperty,m=(e,t,a)=>(((e,t,a)=>{t in e?p(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a})(e,"symbol"!=typeof t?t+"":t,a),a);const g=class{};m(g,"achvPropsNamesMapping",{slug:"id",status:"type",target:"cost",title:"name"}),m(g,"achvPropsValuesMapping",{target:({goal:e})=>e}),m(g,"achvStatusMapping",{allGlobal:"all_global",allLocal:"all_local",completed:"completed",inProgress:"in_progress",expired:"expired"}),m(g,"mapAcvToAchvEntity",e=>Object.entries(e).reduce((e,[t,a])=>{const s=g.achvPropsValuesMapping[t];let i=a;return s&&(i=s(a)),e[g.achvPropsNamesMapping[t]||t]=i,e},{})),m(g,"mapAchvStatus",e=>g.achvStatusMapping[e]);let v=g;var w=Object.defineProperty,f=(e,t,a)=>(((e,t,a)=>{t in e?w(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a})(e,"symbol"!=typeof t?t+"":t,a),a),y=(e,t,a)=>new Promise((s,i)=>{var n=e=>{try{r(a.next(e))}catch(e){i(e)}},o=e=>{try{r(a.throw(e))}catch(e){i(e)}},r=e=>e.done?s(e.value):Promise.resolve(e.value).then(n,o);r((a=a.apply(e,t)).next())});const b=class{};f(b,"setProgressErrMsg","Achievements | setProgress: cannot set achievement progress"),f(b,"getProgressErrMsg","Achievements | getProgress: cannot get achievement progress"),f(b,"getListErrMsg","Achievements | getList: cannot load achievements list"),f(b,"incorrectActionTypeErrMsg","Incorrect action type"),f(b,"logPrefix","Achievements | Parent frame"),f(b,"logColor",{background:"#355c7d",text:"#ffffff"}),f(b,"debugLog",(0,u.M$)(b.logPrefix,u.XG.Dev,b.logColor)),f(b,"lang",c.I.RU),f(b,"appId"),f(b,"isDraft"),f(b,"api"),f(b,"isInitialized",!1),f(b,"init",({api:e,appId:t,isDraft:a,lang:s})=>{b.api=e,b.appId=t,b.isDraft=Boolean(a),b.lang=s,b.isInitialized||(d.Z.onExternalMessage(l.y0,b.onMessage),b.isInitialized=!0)}),f(b,"onMessage",({data:{type:e,action:t,data:a}},s)=>{const i=e=>s({data:{success:!0,result:e}}),n=e=>s({data:{success:!1,error:e}});switch(b.debugLog(`received ${l.y0} messages event: `,e,t,a),t){case"setProgress":b.setProgress(a).then(i).catch(()=>n(b.setProgressErrMsg));break;case"getProgress":b.getList(null,null==a?void 0:a.id).then(e=>{if(!e.length)return Promise.reject();i(e[0].progress)}).catch(()=>n(b.getProgressErrMsg));break;case"getList":b.getList((null==a?void 0:a.status)||null).then(i).catch(()=>n(b.getListErrMsg));break;default:b.log(new Error(`${b.incorrectActionTypeErrMsg}: ${t}`))}}),f(b,"setProgress",(...e)=>y(b,[...e],function*(e={}){const{id:t,progress:a}=e;return t&&void 0!==a?b.api.setAchvProgress({"app-id":b.appId,draft:b.isDraft},{slug:t,progress:{score:a}}).then(({data:e})=>v.mapAcvToAchvEntity(e)):Promise.reject()})),f(b,"getList",(e,t="")=>y(b,null,function*(){if(Boolean(e&&e.length)===Boolean(t))return Promise.reject();const a={lang:b.lang,"app-id":b.appId,draft:b.isDraft};return e&&e.length&&(a.status=v.mapAchvStatus(e[0])),t&&(a.slug=t),b.api.getAchvProgress(a).then(({data:e})=>e.map(e=>v.mapAcvToAchvEntity(e)))})),f(b,"log",({name:e="Error",message:t="Unknown achievements error"},a="")=>{const s=`${e}: ${t}`;b.debugLog(s),(0,h.H)({block:b.logPrefix,message:s,source:b.logPrefix,sourceMethod:a})});let x=b;const C=(0,n.memo)(()=>{const{lang:e,playPageData:{gameInfo:{appId:t,isDraft:a}}}=(0,o.b)(),s=(0,r.z)();return(0,n.useEffect)(()=>x.init({api:s,appId:t,isDraft:a,lang:e}),[s,t,a,e]),null});var _=a(69385),P=a(86712),S=a(12536),I=a(55031),k=a(69278),E=a(30928),j=a(19146),A=a(93335),L=a(50678);const D=a(56710).Z;var M,N=a(65068);const T=(0,u.M$)("src/sdk/common/utils/env",u.XG.Dev),O="undefined"!=typeof window&&(null==(M=window.appData)?void 0:M.env)||void 0,Z=O?O.NODE_ENV:"production",R=(O?O.OAUTH_CLIENT_ID:"86dbf89168b54f1fa5b25462b1bd8cbd")||"";T("NODE_ENV",Z);var B=a(81391),F=a(32221),G=a(13636),U=a(61916),W=a(23665),$=a(60971),H=a(43197),V=a(61712),q=a(99083),z=a(2592),K=a(97731),X=a(99251),Y=Object.defineProperty,J=(e,t,a)=>(((e,t,a)=>{t in e?Y(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a})(e,"symbol"!=typeof t?t+"":t,a),a);const Q=(0,u.M$)("auth-dialog-manager",u.XG.Dev);class ee extends n.Component{constructor(e){var t;super(e),J(this,"openPromise",null),J(this,"waitAuthPromise",null),J(this,"authCookieName"),J(this,"login"),J(this,"state",{requestId:"",visible:!1}),J(this,"handleMessageEvent",e=>{var t;(0,G.aB)(e)&&(null==(t=this.waitAuthPromise)||t.resolve({}))}),J(this,"checkLogin",()=>{const e=(0,W.e)(this.authCookieName);this.login&&e&&this.login!==e&&(Q("AuthDialogManager: change_account"),(0,V.U4)({},{backgroundAuthChange:"change_account"})),this.login=e}),J(this,"setWaitAuthPromise",e=>{const t=new k.Z,a=window.setInterval(()=>{e&&e.opener||t.resolve({error:new N.Z({message:"Can not find auth window opener.",code:"AUTH_WINDOW_REJECTED"})})},z.WT);return t.promise.finally(()=>{if(window.clearInterval(a),e)try{e.close()}catch(e){(0,h.H)({block:K.W.SDK_PROXY},e)}this.waitAuthPromise=null,e=void 0}),this.waitAuthPromise=t,this.waitAuthPromise.promise}),J(this,"onInternalMessage",(e,t)=>{const{action:a,data:s}=e.data;if(this.isDisabled)return t({error:new Error("auth disabled")});"open"!==a&&"open-auth-window"!==a||(this.close(),this.setState({requestId:s.requestId},()=>{this.createAuthPromise(e,t)}))}),J(this,"onAuthChanged",e=>{const{action:t,data:a}=e.data;["changed","auth-dialog-success"].includes(t)&&a.hasAuth!==this.props.hasAuth&&this.props.getUserPassport()}),J(this,"onDialogApply",()=>{this.sendParams("ok");const e=this._openAuthWindow();e?this.resolvePromise(e):this.rejectPromise(new N.Z({code:"AUTH_WINDOW_REJECTED",message:"Can not open auth window."})),this.close()}),J(this,"onDialogClose",()=>{this.sendParams("cancel"),this.close()});const a=(null==(t=(0,i.getDomainConfig)().auth)?void 0:t.provider)===I.Xi.XSOLLA;this.authCookieName=a?"xsolla_login":"yandex_login",this.login=(0,W.e)(this.authCookieName)}componentDidMount(){d.Z.onInternalMessage("auth-dialog",this.onInternalMessage),d.Z.onInternalMessage("auth",this.onAuthChanged,{withHistory:!0}),document.addEventListener("visibilitychange",this.checkLogin),window.addEventListener("message",this.handleMessageEvent)}componentWillUnmount(){d.Z.offInternalMessage("auth-dialog",this.onInternalMessage),d.Z.offInternalMessage("auth",this.onAuthChanged),document.removeEventListener("visibilitychange",this.checkLogin),window.removeEventListener("message",this.handleMessageEvent),this.rejectPromise(new N.Z({code:"AUTH_DIALOG_CANCEL",message:"Component unmounted."})),this.waitAuthPromise&&this.waitAuthPromise.resolve({error:new N.Z({code:"AUTH_DIALOG_CANCEL",message:"Component unmounted."})})}componentDidUpdate(e){e.hasAuth!==this.props.hasAuth&&(this.login=(0,W.e)(this.authCookieName),this.props.hasAuth?this.props.fetchPlatformSubscriptions():this.props.clearPlatformSubscriptions())}createAuthPromise(e,t){const{action:a,data:s}=e.data;let i;switch(a){case"open-auth-window":i=this.openAuthWindow(!1,s.origin);break;case"open":i=this.open();break;default:return}i.then(e=>this.setWaitAuthPromise(e)).then(e=>{t(e)}).catch(e=>{Q(`${a} auth dialog error`,e),t({error:e})})}sendParams(e){(0,V.U4)({},{borrowParams:{sdk:{auth:{dialog:e,appId:this.context.playPageData.gameInfo.appId}}}})}open(){return e=this,t=function*(){if(!this.props.hasAuth){if(!this.props.inCurrentTab){const e=yield this._tryOpenAuthWindowOnStart();if(e)return Promise.resolve(e)}return this.openPromise||(this.openPromise=new k.Z),this.showDialog(),this.openPromise.promise}},new Promise((a,s)=>{var i=e=>{try{o(t.next(e))}catch(e){s(e)}},n=e=>{try{o(t.throw(e))}catch(e){s(e)}},o=e=>e.done?a(e.value):Promise.resolve(e.value).then(i,n);o((t=t.apply(e,null)).next())});var e,t}openAuthWindow(e=!1,t){if(e)return Promise.resolve(this._openAuthWindow(t)||void 0);const{hasAuth:a}=this.props;return Promise.resolve(a?void 0:this._openAuthWindow(t)||void 0)}_tryOpenAuthWindowOnStart(){return function(){const{userAgent:e}=window.navigator;return!/^((?!chrome|android).)*safari/i.test(e)&&!/\sFirefox\//.test(e)&&!!/\sChrome\//.test(e)}()&&this.openAuthWindow()||Promise.resolve(void 0)}showDialog(){this.setState({visible:!0})}resolvePromise(e){this.openPromise&&(this.openPromise.resolve(e),this.openPromise=null)}rejectPromise(e){this.openPromise&&(this.openPromise.reject(e),this.openPromise=null)}close(){this.setState({requestId:"",visible:!1}),this.rejectPromise(new N.Z({code:"AUTH_DIALOG_CANCEL",message:"User canceled auth dialog."}))}getOauthUrl(e){const{baseUrl:t}=this.context;return`https://${(0,$.sW)()}/authorize?${[`client_id=${R}`,"response_type=code",`redirect_uri=${encodeURIComponent(`${(0,X.e)().origin}${t}/auth/oauth?request_id=${encodeURIComponent(e)}`)}`].join("&")}`}getXsollaAuthUrl(e){const{baseUrl:t,lang:a}=this.context;return`${(0,X.e)().origin}${t}/auth/xsolla?${["mode=auth",`request_id=${encodeURIComponent(e)}`,`lang=${a}`].join("&")}`}_openAuthWindow(e="games_sdk_auth"){const t=(0,q.zd)(),a=(0,U.KT)(),s=(0,S.Me)(a,S.QQ.ByteApp),n=this.props.inCurrentTab||t||s||this.context.isTranssion,{provider:o}=(0,i.getDomainConfig)().auth||{};let r="";n?(r=(0,X.e)().href,s&&(r=(0,F.Z)({url:r,params:{clid:a}}))):r=(0,B.EP)(`${(0,X.e)().origin}${this.context.baseUrl}/sdk/static/auth-retpath.html?req-id=${encodeURIComponent(this.state.requestId)}&origin=${encodeURIComponent(window.origin)}&version=${encodeURIComponent(this.context.version)}`);const l=(0,H.x)()?$.tu:"";let c=`https://${(0,$.GH)()}/auth${l}?from=game&origin=${encodeURIComponent(e)}&retpath=${encodeURIComponent(r)}`;const{requestId:d}=this.state;if(this.props.isOauth){if(!d)return void(0,h.H)({},new Error("No requestId for OAuthURL"));c=this.getOauthUrl(d)}else if(o===I.Xi.XSOLLA){if(!d)return void(0,h.H)({},new Error("No requestId for XSollaUrl"));c=this.getXsollaAuthUrl(d)}if(!n)return window.open(c,"_blank");window.location.href=c}get isDisabled(){const e=(0,U.KT)();return(0,S.Me)(e,S.QQ.PlayGames)}render(){return this.state.visible?(0,s.jsx)(D,{onApply:this.onDialogApply,onClose:this.onDialogClose}):null}}J(ee,"contextType",L.Z);const te=(0,E.$j)(function(e){return{isOauth:e.userData.isOauth,hasAuth:Boolean(e.userData.login)}},function(e){return(0,j.DE)({getUserPassport:A.Ps,fetchPlatformSubscriptions:A.VR,clearPlatformSubscriptions:A.cp},e)})(ee);var ae=a(79020),se=a(65564),ie=a(38225),ne=a(39138);const oe=a(6682).P,re=()=>{const{isVisible:e,openedFrom:t}=(0,ie.C)(e=>e.platformPurchaseModal),a=(0,ie.C)(e=>e.platformPurchases.products),i=(0,ie.T)(),o=(0,ne.T)(),r=(0,n.useCallback)(e=>{d.Z.post({type:"payments",action:"platform-purchase-start",data:{openedFrom:t,paymentsConfig:{},purchaseConfig:{id:e,developerPayload:""}}}),i((0,A.Lu)({isVisible:!1}))},[i,t]),l=(0,n.useCallback)(()=>{i((0,A.Lu)({isVisible:!1}))},[i]),c=(0,n.useMemo)(()=>[...a.value||[]].map(e=>({value:e.id,title:o(`platform.purchase.${[e.id]}`),price:e.info.price})),[a.value,o]);return e?(0,s.jsx)(oe,{items:c,onButtonClick:r,onClose:l}):null};var le=a(31389),ce=a(51939),de=a(74516),he=a(97467),ue=a(94365),pe=Object.defineProperty,me=(e,t,a)=>(((e,t,a)=>{t in e?pe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a})(e,"symbol"!=typeof t?t+"":t,a),a);class ge extends L.P{constructor(){super(...arguments),me(this,"promiseWrapper"),me(this,"state",{dialogIsRequested:!1,dialogWasRequested:!1,isCanShow:!1,reason:"UNKNOWN",wasTriggered:!1}),me(this,"onInternalMessage",e=>{var t,a;if("request-review"===e.data.action){this.setState({dialogIsRequested:!0});const{gameInfo:e}=this.context.playPageData,s=null==(a=null==(t=this.context.playPageData)?void 0:t.gameData)?void 0:a.media;this.props.dispatch((0,A.N3)({appID:parseInt(e.appId,10),gameID:e.appId,pictureUrl:s?(0,de.Jn)(s,{size:de.KL.pjpg84x84}):"",game:e,gameName:e.title}))}}),me(this,"onExternalMessage",(e,t)=>{switch(e.data.action){case"request-review":this.setPromise(),this.openPopupDialog().then(e=>{this.setState({dialogIsRequested:!1},()=>{t({data:e})})}).catch(e=>{t({data:{feedbackSent:!1,reason:e}})});break;case"can-review":this.releasePromise(),this.canShowPopup().then(({hasAuth:e,rated:a,isCanShow:s,reason:i})=>{s?this.setState({isCanShow:s},()=>{t({data:{value:s}})}):this.state.wasTriggered&&i?t({data:{reason:i,value:s}}):a?this.setState({reason:"GAME_RATED",wasTriggered:!0},()=>{t({data:{reason:"GAME_RATED",value:!1}})}):e?this.setState({isCanShow:!0,wasTriggered:!0},()=>{t({data:{value:!0}})}):this.setState({reason:"NO_AUTH",wasTriggered:!0},()=>{t({data:{reason:"NO_AUTH",value:!1}})})}).catch(()=>{this.setState({reason:"UNKNOWN",wasTriggered:!0},()=>{t({data:{reason:"UNKNOWN",value:this.state.isCanShow}})})})}})}componentDidMount(){var e;const{gameInfo:t}=this.context.playPageData,a=null==(e=this.context.playPageData.gameData)?void 0:e.media;this.props.dispatch((0,A.N3)({appID:parseInt(t.appId,10),gameID:t.appId,pictureUrl:a?(0,de.Jn)(a,{size:de.KL.pjpg84x84}):"",game:t,gameName:t.title})),d.Z.onExternalMessage("feedback",this.onExternalMessage),d.Z.onInternalMessage("feedback",this.onInternalMessage)}componentWillUnmount(){d.Z.offExternalMessage("feedback",this.onExternalMessage),d.Z.offInternalMessage("feedback",this.onInternalMessage),this.props.dispatch((0,A.N3)({appID:null,gameID:null,rating:0,text:""}))}componentDidUpdate(e){if(this.promiseWrapper&&e.appID&&!this.props.appID){switch(e.state){case"success":this.promiseWrapper.resolve(e.result);break;case"error":this.promiseWrapper.reject(new Error("Unknown"));break;case"ready":this.promiseWrapper.resolve({feedbackSent:!1})}this.promiseWrapper=void 0}}releasePromise(){this.promiseWrapper&&(this.promiseWrapper.reject(new Error("Reject")),this.promiseWrapper=void 0)}setPromise(){this.releasePromise(),this.promiseWrapper=new k.Z}canShowPopup(){return new Promise((e,t)=>{if((0,H.x)())return e({isCanShow:!1,reason:"REQUESTED_FROM_TV"});const{feedbackSettings:a}=(0,i.getDomainConfig)();if(!(0,he.w)(this.context.tld,null==a?void 0:a.allowedTlds))return e({isCanShow:!1,reason:"UNKNOWN"});const{hasAuth:s}=this.props;if(s&&$.XK&&"NO_AUTH"===this.state.reason)return void e({isCanShow:!0});if(this.state.wasTriggered&&this.state.isCanShow)return void e({isCanShow:this.state.isCanShow});if(this.state.wasTriggered&&!this.state.dialogIsRequested&&!this.state.dialogWasRequested)return void e({isCanShow:this.state.isCanShow,reason:this.state.reason});if(!s&&$.XK)return void e({isCanShow:!1,reason:"NO_AUTH"});if(this.state.dialogIsRequested)return void e({isCanShow:!1,reason:"REVIEW_ALREADY_REQUESTED"});if(this.state.dialogWasRequested)return void e({isCanShow:!1,reason:"REVIEW_WAS_REQUESTED"});const{appId:n}=this.context.playPageData.gameInfo;this.props.dispatch((0,A.bq)(parseInt(n,10))).then(e).catch(t)})}openPopupDialog(){var e;return this.state.wasTriggered&&this.state.isCanShow&&!this.state.dialogIsRequested&&!this.state.dialogWasRequested||(0,ue._G)()?(this.setState({dialogIsRequested:!0,dialogWasRequested:!0,isCanShow:!1}),(null==(e=this.promiseWrapper)?void 0:e.promise)||Promise.reject(new Error("Unexpected error"))):Promise.reject(new Error("Unexpected usage (use canReview before requestReview)"))}render(){return this.state.dialogIsRequested?(0,s.jsx)(ce.Z,{}):null}}const ve=(0,E.$j)(function(e){return{appID:e.feedback.appID,rating:e.feedback.rating,result:e.feedback.result,state:e.feedback.state,hasAuth:Boolean(e.userData.uid)}})(ge);var we=a(71277),fe=a(38207);const ye=(0,n.memo)(()=>{const{gameplaySwitch:e}=(0,fe.jT)(),t=(0,n.useCallback)(({data:t})=>e(t.action),[e]);return(0,n.useEffect)(()=>(d.Z.onExternalMessage(l.Tn,t,{withHistory:!1}),()=>d.Z.offExternalMessage(l.Tn,t)),[t]),(0,s.jsx)(s.Fragment,{})});var be=a(28010),xe=a(61582),Ce=a(45682),_e=a(76753),Pe=a(38995);const Se=(0,u.M$)("GamePromocodeNotifier",u.XG.Dev),Ie=()=>{const e=(0,ie.C)(e=>{var t,a,s,i;return null==(i=null==(s=null==(a=null==(t=e.promocode)?void 0:t.coupon)?void 0:a.benefit)?void 0:s.in_app_bonus)?void 0:i.app_id}),t=(0,ie.C)(e=>{var t;return null==(t=e.promocode)?void 0:t.reserved}),a=(0,n.useMemo)(()=>(0,Pe.p)(window.appData),[]);(0,_e.q)(()=>{Se("mounted")}),(0,n.useEffect)(()=>{e&&t&&e===Number(a)&&s()},[e,a,t]);const s=()=>{Se("sendMessageInGame"),d.Z.postToChild((0,Ce.TI)(l.q1.BONUS_AWARDED))};return null};var ke=a(43774),Ee=a(42215),je=a(7579),Ae=a(24176),Le=a(7323),De=a(69874),Me=a(85187),Ne=a(33376),Te=Object.defineProperty,Oe=(e,t,a)=>(((e,t,a)=>{t in e?Te(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a})(e,"symbol"!=typeof t?t+"":t,a),a);const Ze="yandexGames_shortcut_installation_dates",Re=(0,u.M$)("ShortcutManagerCommonApi",u.XG.Popup);function Be(e,t){(0,V.U4)({},{shortcutApi:{action:e,params:t}})}class Fe{constructor(e,t,a){this.context=t,Oe(this,"shortcutEventPrompt"),Oe(this,"waitShowPromptAsync"),Oe(this,"showBeforeInstallprompt"),Oe(this,"beforeInstallEventCallbacks",[]),Oe(this,"expirationCallback"),Oe(this,"shouldCallBeforeInstallEventCallbackImmediataly"),Oe(this,"appId"),Oe(this,"dispatch"),Oe(this,"wasBeforeInstallPrompt",()=>Boolean(this.shouldCallBeforeInstallEventCallbackImmediataly)),this.showBeforeInstallprompt=!1,this.appId=e,this.dispatch=a,window.addEventListener("beforeinstallprompt",e=>{e.preventDefault(),this.shortcutEventPrompt=e,this.callBeforeInstallEventCallbacks()})}addListenerOnSuccessInit(e){this.shouldCallBeforeInstallEventCallbackImmediataly?e():this.beforeInstallEventCallbacks.push(e)}safeCallBeforeInstallEventCallbacks(){this.beforeInstallEventCallbacks.forEach(e=>e()),this.shouldCallBeforeInstallEventCallbackImmediataly=!0}callBeforeInstallEventCallbacks(){this.shouldCallBeforeInstallEventCallbackImmediataly||this.safeCallBeforeInstallEventCallbacks(),this.waitShowPromptAsync&&(this.waitShowPromptAsync=!1,this.showPromptByUserGesture("beforeinstallprompt")),Be("beforeinstallprompt",{show:this.showBeforeInstallprompt})}addListenerOnExpiration(e){this.expirationCallback=e}getSupportStatus(){return Boolean(this.shortcutEventPrompt)}showPromptByUserGesture(e){const t=(0,De.c)(()=>(t(),this.showPrompt(e,je.v.PAGE_OPEN)))}showPromptAsync(e){return t=this,a=function*(){const{source:t}=e;if(Be("showPromptStart",e),this.shortcutEventPrompt)return Re(`ShortcutManagerCommonApi showPromptAsync: showPrompt exists and is called, source: ${e.source}`),t===je.v.PAGE_OPEN?this.showPromptByUserGesture("userGesture"):this.showPrompt("showPrompt",t);this.waitShowPromptAsync=!0;const a=`ShortcutManagerCommonApi showPromptAsync: showPrompt doesn't exist and is called, source: ${e.source}`;if(Re(a),t===je.v.GAME_API)throw new Error(a);console.info(a)},new Promise((e,s)=>{var i=e=>{try{o(a.next(e))}catch(e){s(e)}},n=e=>{try{o(a.throw(e))}catch(e){s(e)}},o=t=>t.done?e(t.value):Promise.resolve(t.value).then(i,n);o((a=a.apply(t,null)).next())});var t,a}readInstallationDates(){const{value:e,wasError:t}=(0,Le.dq)(Ze);if(!t)try{const t=JSON.parse(e||"{}");if(t&&"object"==typeof t)return t}catch(e){(0,h.H)({block:K.W.SHORTCUTS_POPUP_MANAGER,prefix:"Error in readInstallationDates",source:"sdk"},e)}}shouldInstallAgain(){if(!this.appId)return!1;const e=this.readInstallationDates();if(!e)return!1;const t=new Date(e[this.appId]).getTime();return!!isNaN(t)||Math.abs(Date.now()-t)>=Me.E}setInstallationDate(){if(!this.appId)return;const e=this.readInstallationDates()||{};e[this.appId]=(new Date).toISOString(),(0,Le.Ur)(Ze,JSON.stringify(e))}showPrompt(e,t){var a,s,i,n;if(Re("showPrompt"),this.shortcutEventPrompt){if("showPrompt"===e||this.shouldInstallAgain())return Be("showPrompt",{showPromptReason:e}),(0,V.NF)({},Ne.Ji.SHORTCUT_PROMPT_SHOW,{showPromptSource:e}),Ae.Fj.show((0,Ae.oU)({context:this.context,popupType:"system",source:(0,Ae.N7)(t)})),null==(a=this.shortcutEventPrompt)||a.prompt().catch(e=>{Be("showPromptError",{err:e.message}),console.warn("ShortcutManagerCommonApi error: ",e)}),null==(s=this.shortcutEventPrompt)||s.userChoice.then(a=>(Ae.Fj.click((0,Ae.oU)({context:this.context,popupType:"system",source:(0,Ae.N7)(t),result:"accepted"===a.outcome?"accepted":"rejected"})),"accepted"===a.outcome?(0,V.NF)({},Ne.Ji.SHORTCUT_USER_CHOICE_ACCEPTED,{showPromptSource:e}):(this.dispatch((0,A.yf)(!0)),(0,V.NF)({},Ne.Ji.SHORTCUT_USER_CHOICE_DISMISSED,{showPromptSource:e})),this.shortcutEventPrompt=void 0,a)),null==(i=this.expirationCallback)||i.call(this),this.setInstallationDate(),null==(n=this.shortcutEventPrompt)?void 0:n.userChoice;Be("showPromptError",{err:`You can call showPrompt on reason ${e} only once a day`})}}}var Ge=a(98132),Ue=a(71675),We=a(84049),$e=a(10597),He=a(26014),Ve=a(8281),qe=Object.defineProperty,ze=(e,t,a)=>(((e,t,a)=>{t in e?qe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a})(e,"symbol"!=typeof t?t+"":t,a),a);const Ke=(0,u.M$)("ShortcutPopupManager",u.XG.Popup),Xe=z.WT;class Ye extends n.PureComponent{constructor(e){super(e),ze(this,"installationChecker"),ze(this,"shortcutManagerApi"),ze(this,"onExternalMessage",(e,t)=>{return a=this,s=function*(){const{appId:a}=this.context.playPageData.gameInfo,{action:s}=e.data;switch(s){case"can-show-prompt":{const e=this.canShowApiPrompt(a);Ke(`onExternalMessage: action: "${s}", canShow: ${e}`),t({data:{canShow:e}}),this.setState({canShowCalled:!0});break}case"show-prompt":{const e=this.canShowApiPrompt(a);if(Ke(`onExternalMessage: action: "${s}", canShow: ${e}`),e){const e=this.installationChecker.catalogPromptHasShown(a)?"game":"catalog";(0,V.NF)({},Ne.Ji.SHORTCUT_API_SHOW,{shortcutApi:{appId:a,manifestType:e}}),window.setTimeout(()=>{this.showApiPrompt({source:je.v.GAME_API},a).then(e=>{t({data:{outcome:null==e?void 0:e.outcome}})})},Xe)}else this.state.canShowCalled?t({data:{canShow:e,reason:"cannot show prompt"}}):t({data:{canShow:e,reason:"use canShowPrompt before showPrompt"}});break}}},new Promise((e,t)=>{var i=e=>{try{o(s.next(e))}catch(e){t(e)}},n=e=>{try{o(s.throw(e))}catch(e){t(e)}},o=t=>t.done?e(t.value):Promise.resolve(t.value).then(i,n);o((s=s.apply(a,null)).next())});var a,s}),ze(this,"onInternalMessage",e=>{var t,a,s;const{action:i,data:n}=e.data;switch(i){case"show-api-prompt":Ke('onInternalMessage "show-api-prompt"'),this.showApiPrompt({source:n.source});break;case"show-shortcut-popup":Ke('onInternalMessage "show-shortcut-popup"'),this.showShortcutPopup();break;case"show-standalone-api-prompt":Ke('onInternalMessage "show-standalone-api-prompt"'),null==(s=null==(a=null==(t=window.yandex)?void 0:t.app)?void 0:a.installShortcut)||s.call(a);break;case"activate":{Ke('onInternalMessage "activate"');const e=new Event("beforeinstallprompt");e.userChoice=this.createExternalShortcutPromise("user-choice"),e.prompt=()=>this.createExternalShortcutPromise("prompt"),window.dispatchEvent(e);break}}}),ze(this,"createExternalShortcutPromise",e=>new Promise((t,a)=>{const s=`${e}-resolve`,i=`${e}-reject`,n=e=>{const{action:o}=e.data;o!==s&&o!==i||(d.Z.offInternalMessage("shortcut-manager",n),o===s?t(e.data.result):o===i&&a(e.data.result))};d.Z.onInternalMessage("shortcut-manager",n,{withHistory:!0}),"prompt"===e&&d.Z.post({type:"shortcut-manager",action:"prompt"})})),ze(this,"handleCloseShortcutPopup",()=>{const e=(0,Ue.n)();e&&(0,We.Z)(e),this.setState({forcefullyShowShortcutPopup:!1})}),this.state={canShowCalled:!1,forcefullyShowShortcutPopup:!1}}componentDidMount(){const{appId:e}=this.context.playPageData.gameInfo;this.shortcutManagerApi=new Fe(e,this.context,this.props.dispatch),this.installationChecker=new He.Z,this.initMessaging()}initMessaging(){d.Z.onExternalMessage("shortcut-manager",this.onExternalMessage),d.Z.onInternalMessage("shortcut-manager",this.onInternalMessage,{withHistory:!0}),d.Z.post({type:"shortcut-manager",action:"request"})}canShowApiPrompt(e){var t;if((0,ke.v_)({on:"disable_pwa_promo"}))return!1;const a=(0,$e.N)(this.context.uatraits);return this.installationChecker.checkShowCapability(Ve.Wp.GameApi,{waitingPeriod:z.dV,maxShowCount:3,isMiniInfobarEnabled:a},e)&&(null==(t=this.shortcutManagerApi)?void 0:t.getSupportStatus())}showApiPrompt(e,t){const{source:a}=e;if(t&&!this.canShowApiPrompt(t))return Promise.resolve(void 0);const s=new Promise(e=>this.addListenerOnSuccessInit(()=>e(!0))).then(()=>(a===je.v.GAME_API&&this.installationChecker.updateShowData(Ve.Wp.GameApi,t),this.shortcutManagerApi.showPromptAsync(e)));return s.then(e=>{void 0!==e&&(this.props.dispatch((0,A.FJ)(void 0)),a===je.v.GAME_API&&t&&("accepted"===e.outcome?(this.installationChecker.updateInstallationData(Ve.Wp.GameApi,t),this.installationChecker.setLastPromptAccepted(!0,t)):(this.props.dispatch((0,A.yf)(!0)),this.installationChecker.setLastPromptAccepted(!1,t))))}).catch(()=>{}),s}wasBeforeInstallPrompt(){return this.shortcutManagerApi.wasBeforeInstallPrompt()}addListenerOnSuccessInit(e){this.shortcutManagerApi.addListenerOnSuccessInit(e)}addListenerOnExpiration(e){this.shortcutManagerApi.addListenerOnExpiration(e)}showShortcutPopup(){this.setState({forcefullyShowShortcutPopup:!0})}render(){return this.state.forcefullyShowShortcutPopup||this.props.shouldShowShortcutPopup?(0,s.jsx)(Ee.Z,{trigger:this.state.forcefullyShowShortcutPopup?Ge.w.MENU:Ge.w.TIMER,type:this.props.type,onClose:this.handleCloseShortcutPopup}):null}}ze(Ye,"contextType",L.Z);const Je=(0,E.$j)(function(e){return{shouldShowShortcutPopup:e.shouldShowShortcutPopup}})(Ye);var Qe=a(87997),et=a(85743);const tt=()=>{const e=(0,ie.C)(({ui:e})=>e.isGuardOpened),{gamePause:t,gameResume:a}=(0,fe.ff)({reason:"visibility_change"});return(0,n.useEffect)(()=>{if(e)return;const s=()=>{document.hidden?t():a()};return document.addEventListener("visibilitychange",s),()=>document.removeEventListener("visibilitychange",s)},[t,a,e]),(0,s.jsx)(s.Fragment,{})},at=()=>{const{playPageData:e}=(0,o.b)(),t=(0,ie.C)(e=>e.user.payCurrency),a=(0,n.useRef)(!1);return(0,n.useEffect)(()=>{var s,i;if(a.current)return;const{gameInfo:n}=e;n&&((0,V._H)({currencyCode:t,detail:[{id:n.appId,name:n.title,brand:null==(s=n.publisher)?void 0:s.name,category:null==(i=n.categoryNames)?void 0:i[0]}]}),a.current=!0)},[t,e,a]),null};var st=a(95663),it=a(60617);const nt=()=>{const{isGamesApp:e,abt:{flags:t}}=(0,o.b)(),a=(0,st.f)(),{promocodesDisabled:r}=(0,i.getDomainConfig)();return(()=>{const{getState:e}=(0,E.oR)();(0,n.useEffect)(()=>{const t=({data:{action:t,data:a}},s)=>{"listeners-change"===t&&"game_api_pause"===a.event&&s({data:{isPaused:e().gameControl.pauseReasons.size>0}})};return d.Z.onExternalMessage("sdk-internal-event",t),()=>d.Z.offExternalMessage("sdk-internal-event",t)},[e])})(),(0,s.jsxs)(s.Fragment,{children:[!e&&(0,s.jsx)(le.Z,{type:"game"}),(0,s.jsx)(et.Z,{}),(0,s.jsx)(xe.q,{}),(0,s.jsx)(C,{}),(0,s.jsx)(P.Z,{}),(0,s.jsx)(ye,{}),(0,s.jsx)(tt,{}),(0,s.jsx)(ae.Z,{page:"app"}),(0,s.jsx)(ve,{}),(0,s.jsx)(re,{}),(0,s.jsx)(be.Z,{}),a&&(0,s.jsx)(se.H,{}),(0,it.Hp)()&&(0,s.jsx)(we.Z,{}),a&&(0,s.jsx)(at,{}),a&&!r&&(0,s.jsx)(Ie,{}),(0,s.jsx)(te,{}),Boolean((0,it.xO)(t))&&(0,s.jsx)(Qe.Z,{}),(0,s.jsx)("div",{className:"shortcut",children:a&&(0,s.jsx)(Je,{type:"game"})}),_.k&&(0,s.jsx)(_.Z,{})]})}},24754:(e,t,a)=>{a.d(t,{X:()=>f});var s=a(57627),i=a(43774),n=a(36329),o=a(87363),r=a(38225),l=a(86468),c=a(92026),d=a(55990),h=a(77314),u=a(39138),p=a(78825),m=a(4522),g=a(90336),v=a(61712);const w=e=>{switch(e){case"header":return{header:{action:"fullscreen"}};case"controlPanel":return{controlPanel:{action:"fullscreen"}}}},f=({place:e})=>{const t=(0,u.T)(),a=(0,r.C)(e=>Boolean(e.ui.isFullscreenActive)),f=(0,i.v_)({on:"new_game_navigation"}),y=(0,o.useCallback)(()=>{var t;(0,v.U4)({},{borrowParams:w(e)}),c.H.dispatch((0,l.GF)(e)),f&&(null==(t=window.clickdaemonLog)||t.call(window,"game_fullscreen_button_click",{place:e})),p.Z.post({type:"screen-manager",action:"toggle-fullscreen"})},[e,f]);return(()=>{const{isIpad:e}=(0,h.b)(),t=(0,r.C)(e=>e.ui.isFullscreenEnabled);return!e&&!(Boolean("object"==typeof window&&window.parent!==window)&&!(0,g.r)())&&t})()?(0,s.jsx)(n.z,{className:(0,m.E)("GameFullscreenButton-critical-module__fullscreen--X5ii0","pointer","hover"),iconLeft:(0,s.jsx)(d.Z,{modifiers:{enable:!a,env:"desktop"},type:"fullscreen"}),iconLeftAlt:t(a?"header.button.exit-fullscreen.text":"header.button.enter-fullscreen.text"),size:32,view:"empty",onClick:y}):null}},92769:(e,t,a)=>{a.d(t,{V:()=>I});var s=a(57627),i=a(43774),n=a(36329),o=a(87363),r=a(38225),l=a(96533),c=a(55990),d=a(57700),h=a(39138),u=a(49808),p=a(4522),m=a(61712),g=a(7323),v=a(29513);var w=Object.defineProperty,f=Object.getOwnPropertySymbols,y=Object.prototype.hasOwnProperty,b=Object.prototype.propertyIsEnumerable,x=(e,t,a)=>t in e?w(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,C=(e,t)=>{for(var a in t||(t={}))y.call(t,a)&&x(e,a,t[a]);if(f)for(var a of f(t))b.call(t,a)&&x(e,a,t[a]);return e};const _=(e,t)=>{switch(e){case"header":return{header:{action:t}};case"controlPanel":return{controlPanel:{action:t}};case"middleLayer":return{middleLayer:{action:t}};default:return{}}},P=({inNewNavigation:e})=>{const t=(0,r.C)(e=>{var t;return Boolean(null==(t=e.middleLayerInGameData)?void 0:t.show)})||(0,i.v_)({on:"new_game_navigation_simplified"}),a=(0,r.C)(l.Up);return e?(0,s.jsx)(c.Z,{type:"kebab"}):(0,s.jsx)(c.Z,{type:t&&!a?"game-menu-black":"game-menu-white"})};function S({inNewNavigation:e,action:t,eventName:a,place:s}){var i;(0,m.U4)({},{borrowParams:_(s,t)}),e&&(null==(i=window.clickdaemonLog)||i.call(window,a,{place:s}))}const I=e=>{const t=e,{buttonSize:a,buttonViewType:l,direction:c,scope:m,place:w="header"}=t,x=((e,t)=>{var a={};for(var s in e)y.call(e,s)&&t.indexOf(s)<0&&(a[s]=e[s]);if(null!=e&&f)for(var s of f(e))t.indexOf(s)<0&&b.call(e,s)&&(a[s]=e[s]);return a})(t,["buttonSize","buttonViewType","direction","scope","place"]),_=(0,h.T)(),[I,k]=(0,o.useState)(!1),E=(0,o.useRef)(!1),j=(0,o.useRef)(null),{isDotted:A,setIsDotted:L}=(()=>{const e=(0,r.C)(e=>e.advPartnerInfo.advEnabledByPartner),t=(0,u.E)()&&!(0,g.dq)(v.b_).value,[a,s]=(0,o.useState)(t||!(0,g.dq)(v.Z5).value&&Boolean(e));return{isDotted:a,setIsDotted:s}})(),D=(0,i.v_)({on:"new_game_navigation"})&&(0,i.v_)({off:"new_game_navigation_simplified"}),M=(0,o.useCallback)(e=>{e.isMenuItem||e.isBackLink||window.history.back(),E.current=!1,k(!1)},[]),N=(0,o.useCallback)(e=>{M({isMenuItem:Boolean(null==e?void 0:e.isMenuItem),isBackLink:!1})},[M]),T=(0,o.useCallback)(()=>{S({inNewNavigation:D,action:"hide-menu-back",eventName:"game_menu_back_button_click",place:w}),M({isMenuItem:!1,isBackLink:!0})},[M,w,D]),O=(0,o.useCallback)(()=>{I&&"header"!==w?N():(L(!1),k(!0),E.current=!0,S({inNewNavigation:D,action:"menu",eventName:"game_menu_button_click",place:w}),setTimeout(()=>window.history.pushState("menu","","#menu"),0),window.addEventListener("popstate",T,!1))},[I,L,D,w,T,N]);return(0,o.useEffect)(()=>{E.current&&!I&&window.removeEventListener("popstate",T)},[I,T]),(0,o.useEffect)(()=>()=>{window.removeEventListener("popstate",T)},[T]),(0,s.jsxs)("div",{className:(0,p.E)(A&&!D&&"GameMenuButton-critical-module__dotted--YV6jg"),children:[(0,s.jsx)(n.z,{className:"pointer hover",iconLeft:(0,s.jsx)(P,{inNewNavigation:D}),iconLeftAlt:_("common.menu"),ref:j,size:a||32,view:l||"empty",onClick:O}),I&&(0,s.jsx)(d.Z,C({anchorRef:j,direction:c,scope:m,onClose:N},x))]})}},44914:(e,t,a)=>{a.d(t,{Z:()=>n});var s=a(57627),i=a(34957);const n=()=>(0,s.jsx)(i.Z,{isFullscreen:!0})},49808:(e,t,a)=>{a.d(t,{E:()=>n,X:()=>i});var s=a(77314);const i=e=>!0===e.gameSettings.extraFeatures.leaderboards,n=()=>{const{playPageData:e}=(0,s.b)();return i(e)}},93582:(e,t,a)=>{a.d(t,{Z:()=>r,p:()=>l});var s=a(12536),i=a(68755),n=a(99251);function o(e){return"true"===new URLSearchParams(e).get("info")}function r({clid:e,flags:t,isConfirmedGuard:a,location:r}){return!(t.skip_guard||(0,s.Me)(e,s.QQ.YangoGo)||(l=r.search,l&&"1"===new URLSearchParams(l).get(i.U))||!function(e){return e?o(e.hash.slice(1))||o(e.search):"undefined"!=typeof window&&o((0,n.e)().search)}(r)&&a);var l}function l(e){return Boolean(null==e?void 0:e.guard)}},97467:(e,t,a)=>{function s(e,t){return Boolean(0===(null==t?void 0:t.length)||(null==t?void 0:t.some(t=>t===e)))}a.d(t,{w:()=>s})},38995:(e,t,a)=>{a.d(t,{p:()=>o});var s=a(65751),i=a(4366),n=a(99251);function o(e){const{pathname:t,search:a}=(0,n.e)();return function(e){return s.parse(e.slice(1)).app}(a)||(0,i.f)(e,t)}},51936:(e,t,a)=>{a.r(t)},83858:(e,t,a)=>{a.r(t)}}]);
//# sourceMappingURL=https://s3.mdst.yandex.net/games/source-maps/_/build/client/game/desktop/yandex/GameBody.component.async.bca2896aef8610ffe3a7.js.map