"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([[8401],{80837:(e,t,r)=>{r.d(t,{Z:()=>s});var a=r(87363);const s=e=>{(0,a.useEffect)(()=>{const t=document.body.style.overflow;return e&&(document.body.style.overflow="hidden"),()=>{document.body.style.overflow=t}},[e])}},69354:(e,t,r)=>{r.r(t),r.d(t,{DisableAdv:()=>R});var a=r(87363),s=r(36137),n=r(17457),o=r(29789),i=r(57627),c=r(19956),l=r(25195),d=r(52748),p=r(84600),u=Object.defineProperty,h=Object.defineProperties,m=Object.getOwnPropertyDescriptors,f=Object.getOwnPropertySymbols,y=Object.prototype.hasOwnProperty,v=Object.prototype.propertyIsEnumerable,b=(e,t,r)=>t in e?u(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;const g=({is:e,children:t})=>{const{step:r,setStep:s}=(0,l.K)(),{StepView:n,nextStep:o,prevStep:u}=(0,d.o)(r),g=(0,a.useMemo)(()=>r!==p.x.Empty&&e.includes(r)?n:null,[r,e,n]),w=(0,a.useCallback)(()=>{s(o)},[s,o]),P=(0,a.useCallback)(()=>{u&&s(u)},[s,u]),k=(0,a.useCallback)((e={})=>{return g?(0,i.jsx)(n,(t=((e,t)=>{for(var r in t||(t={}))y.call(t,r)&&b(e,r,t[r]);if(f)for(var r of f(t))v.call(t,r)&&b(e,r,t[r]);return e})({},e),h(t,m({nextStep:o,onCompleted:()=>{var t;null==(t=e.onCompleted)||t.call(e),w()},onError:()=>{P()},onSkipped:()=>{var t;null==(t=e.onSkipped)||t.call(e),c.k.skippedStep({step:r}),w()}})))):null;var t},[g,n,o,w,r,P]);return g?t?t({Step:k}):(0,i.jsx)(k,{}):null};var w=r(4522),P=(r(33332),r(51340)),k=r(77314);const S={drawerContent:"wrapper-critical-module__drawerContent--ErMzG"},I=({children:e,onClose:t})=>{const{rootRef:r}=(0,k.b)();return(0,i.jsx)(P.Z,{closeButtonTestId:"disable-adv-close-button",containerClassName:S.modalWrapper,testId:"disable-adv-modal",onClose:t,children:e})},j="disable-adv-module__withPadding--vum7V",O=({children:e,className:t})=>(0,i.jsx)("div",{className:(0,w.E)("auth-layout-module__authLayout--mfelv",t),"data-testid":"disable-adv-auth-layout",children:e});var E=r(61631),_=r(84065),x=r(25678);const C=({children:e,className:t})=>{const r=(0,x.u)();return(0,i.jsxs)("div",{className:(0,w.E)("main-layout-critical-module__mainLayout--_lZkj",t),"data-testid":"disable-adv-main-layout",children:[(0,i.jsx)(E.t,{}),e,(0,i.jsx)(_.w,{paymentService:r})]})},D=r(60918).z,R=()=>{const{isInProgress:e,cancelPlatformProductPurchase:t,buyPlatformProduct:r,selectedProduct:c}=(0,o.O)(),{payCurrency:l}=(0,a.useContext)(n.a),{isBalanceEnoughToBuy:d,balance:u}=(0,s.O)(),h=(0,a.useCallback)(()=>{t()},[t]);return e?(0,i.jsxs)(I,{onClose:h,children:[(0,i.jsx)(g,{is:[p.x.Auth],children:({Step:e})=>(0,i.jsx)(O,{className:(0,w.E)(j,"disable-adv-module__authLayout--KqKPR"),children:(0,i.jsx)(e,{})})}),(0,i.jsx)(g,{is:[p.x.Products,p.x.PurchaseStatus],children:({Step:e})=>(0,i.jsx)(C,{className:(0,w.E)(j,"disable-adv-module__mainLayout--kzt70"),children:(0,i.jsx)(e,{})})}),(0,i.jsx)(g,{is:[p.x.Purchase],children:({Step:e})=>d(Number(null==c?void 0:c.price))?(r(),null):(0,i.jsx)(D,{children:(0,i.jsx)(e,{meta:{balance:u,payCurrency:l}})})})]}):null}},41145:(e,t,r)=>{r.d(t,{Z:()=>a});var a=(e=>(e.BALANCE="balance",e.PURCHASE="purchase",e))(a||{})},74344:(e,t,r)=>{r.d(t,{Z:()=>v});var a=r(57627),s=r(63904),n=r.n(s),o=r(87363),i=r(30928),c=r(55990),l=r(61712),d=r(55222),p=r(36850),u=r(33376),h=Object.defineProperty,m=(e,t,r)=>(((e,t,r)=>{t in e?h(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r})(e,"symbol"!=typeof t?t+"":t,r),r);const f=n().with("close-button");class y extends o.PureComponent{constructor(){super(...arguments),m(this,"handleClick",e=>{e.preventDefault(),e.stopPropagation(),this.props.disabled||(0,p.D)(()=>{var e;this.props.onClick(d.hz.cross),(0,l.NF)({},u.Ji.CLOSE_BUTTON_CLICK,{source:null!=(e=this.props.source)?e:""})})})}render(){const{color:e,"data-testid":t,disabled:r,mix:s,type:n,getText:o}=this.props;return(0,a.jsx)(c.Z,{alt:o("common.close"),className:`${f({color:e,disabled:r,type:n})} ${s}`,"data-testid":t,size:"m",onClick:this.handleClick})}}m(y,"defaultProps",{mix:"",onClick:()=>{}});const v=(0,i.$j)(function(e){return{getText:e.getText}})(y)},55854:(e,t,r)=>{r.d(t,{Kk:()=>D,ky:()=>x,rU:()=>C});var a=r(57627),s=r(65751),n=r(87363),o=r.n(n),i=r(68927),c=r(75303),l=r(50678),d=r(77314),p=r(84561),u=r(21713),h=r(26433),m=r(24062),f=r(99251),y=r(14579),v=Object.defineProperty,b=Object.defineProperties,g=Object.getOwnPropertyDescriptors,w=Object.getOwnPropertySymbols,P=Object.prototype.hasOwnProperty,k=Object.prototype.propertyIsEnumerable,S=(e,t,r)=>t in e?v(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,I=(e,t)=>{for(var r in t||(t={}))P.call(t,r)&&S(e,r,t[r]);if(w)for(var r of w(t))k.call(t,r)&&S(e,r,t[r]);return e},j=(e,t)=>b(e,g(t)),O=(e,t)=>{var r={};for(var a in e)P.call(e,a)&&t.indexOf(a)<0&&(r[a]=e[a]);if(null!=e&&w)for(var a of w(e))t.indexOf(a)<0&&k.call(e,a)&&(r[a]=e[a]);return r};const E=e=>{const{basename:t,currentLocation:r,event:a,link:s,navigate:n,onClickCallback:o,rel:i,redirParams:c,target:l}=e,d="undefined"!=typeof window&&(0,m.V)(void 0,window.navigator.userAgent),p=((e,t)=>!e||"_self"===e||t)(l,d),u=history&&p&&!d,f=x(s,{basename:t,currentLocation:r,skipBasename:Boolean(u),redirParams:c});null==a||a.preventDefault(),null==o||o(a),u?n(f):(0,h.n)({doNotUseWindowOpen:p,href:f,target:l||"_self",windowOpenFeatures:i})},_=e=>"string"==typeof e?e:e.pathname+e.search+e.hash;function x(e,t){var r;try{if("string"!=typeof e&&!e.pathname)return console.warn(`Enriching redirect with destination=${JSON.stringify(e)} failed with non-supported destination value`),_(e)}catch(t){return console.warn("Enriching redirect with destination (couldn't convert to string) failed with non-supported destination value"),_(e)}try{const{forcedRN:a,skipBasename:n,redirParams:o}=t;let i;const c="string"==typeof e,l=c&&/^[a-z-]+:\/\//i.test(e);c?i=l?new URL(e):new URL(`https://example.com${e}`):(i=new URL(`https://example.com${e.pathname}`),e.search&&(i.search=e.search),e.hash&&(i.hash=e.hash));let d="";n||(d=t.basename?"/"+t.basename.replace(/^\/|\/$/g,""):""),i.pathname=d+i.pathname;const h=s.parse(i.hash.slice(1)),m=s.parse(i.search.slice(1)),v=h["redir-data"],b=null!=(r=Array.isArray(v)?v[0]:v)?r:"{}";let g={};try{g=I(I({},JSON.parse(b)),o)}catch(t){console.warn(`Enriching redirect for ${JSON.stringify(e)} failed with incorrect redir-data props. Error:`,t)}if(!g.http_ref){const e=function(e,t){let r;if(e?r=e:"undefined"!=typeof window&&(r=(0,f.e)().href),!r)return;const a=new URL(r);return t&&(a.hash=""),encodeURIComponent((0,p.q)(a,["redir-data"]))}(t.currentLocation,t.skipHash);e&&(g.http_ref=e)}g.rn=null!=a?a:(0,y.Bt)(),h["redir-data"]=JSON.stringify(g);let w=(0,u.q$)();return w&&0!==Object.keys(w).length&&(m[u.fP]=JSON.stringify(w)),i.search=s.stringify(m),i.hash=s.stringify(h),l?i.href:i.pathname+i.search+i.hash}catch(t){return console.warn(`Enriching redirect with destination=${JSON.stringify(e)} failed with error`,t),_(e)}}const C=(0,n.forwardRef)(function(e,t){const r=(0,i.s0)(),s=e,{to:d,currentLocation:p,children:u,target:h,rel:m,onClick:f}=s,y=O(s,["to","currentLocation","children","target","rel","onClick"]),v=o().useContext(l.Z).baseUrlWithLangPath,b=(0,n.useCallback)(e=>E({basename:v,event:e,navigate:r,link:d,onClickCallback:f,rel:m,target:h}),[v,d,h,m,f,r]);return(0,a.jsx)(c.rU,j(I({ref:t,to:d,onClick:b},y),{children:u}))});C.displayName="Link";const D=(0,n.forwardRef)(function(e,t){const r=e,{href:s,currentLocation:o,children:c,target:l,rel:p,onClick:u,redirParams:h}=r,m=O(r,["href","currentLocation","children","target","rel","onClick","redirParams"]),f=(0,i.s0)(),{oneTabPWA:y}=(0,d.b)(),v=(0,n.useCallback)(e=>E({event:e,navigate:f,link:s,onClickCallback:u,rel:p,target:l,oneTabPWA:y,redirParams:h}),[s,l,p,u,f,y,h]);return(0,a.jsx)("a",j(I({href:s,ref:t,onClick:v},m),{children:c}))});D.displayName="OutLink"},51340:(e,t,r)=>{r.d(t,{Z:()=>y});var a=r(57627),s=r(63904),n=r.n(s),o=r(84383),i=r(87363),c=r.n(i),l=r(74344),d=r(4522),p=r(32743),u=Object.defineProperty,h=(e,t,r)=>(((e,t,r)=>{t in e?u(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r})(e,"symbol"!=typeof t?t+"":t,r),r);const m=n().with("modal-wrapper"),f=class e extends i.PureComponent{constructor(){super(...arguments),h(this,"elementRef",c().createRef()),h(this,"handleCloseButtonClick",()=>{var e,t;this.props.onClose(),null==(t=(e=this.props).onCloseButtonLog)||t.call(e)}),h(this,"handleModalClick",e=>{var t,r;this.props.closeByOuterClick&&e.target.classList.contains(m())&&(this.props.onClose(),null==(r=(t=this.props).onCloseBackgroundLog)||r.call(t))})}componentDidMount(){null!==this.elementRef.current&&this.props.blockBodyScroll&&(0,o.Qp)(this.elementRef.current,{allowTouchMove:e=>{for(;e&&e!==document.body;){if(null!==e.getAttribute("data-body-scroll-lock-ignore"))return!0;if(!e.parentElement)return!1;e=e.parentElement}return!1},reserveScrollBarGap:!0})}componentWillUnmount(){null!==this.elementRef.current&&this.props.blockBodyScroll&&(0,o.tG)(this.elementRef.current)}render(){const{buttonClassName:t="",centeredVertically:r,children:s,closeButtonColor:n,closeButtonType:o,closeButtonTestId:i,cls:c="",containerClassName:u="",containerRef:h,isAdaptive:f,style:y,testId:v}=this.props;let b=this.elementRef;return h&&(b=(0,p.l)(this.elementRef,h)),(0,a.jsx)("div",{className:(0,d.E)(m({"centered-vertically":r,adaptive:f}),c),"data-testid":v,ref:b,style:y,onClick:this.handleModalClick,children:(0,a.jsxs)("div",{className:(0,d.E)(m("container"),u),children:["none"!==o&&(0,a.jsx)(l.Z,{color:n||"black","data-testid":i,mix:(0,d.E)(t),type:o||e.defaultProps.closeButtonType,onClick:this.handleCloseButtonClick}),s]})})}};h(f,"defaultProps",{blockBodyScroll:!0,centeredVertically:!0,closeButtonType:"popup",closeByOuterClick:!0,isAdaptive:!1});let y=f},84065:(e,t,r)=>{r.d(t,{w:()=>m});var a=r(57627),s=r(19291);const n=({list:e})=>0===e.length?null:(0,a.jsx)("div",{className:"purchase-method-list-module__purchaseMethodList--T_4LL",children:e.map(e=>(0,a.jsx)(s.Z,{className:"purchase-method-list-module__iconContainer--JXHmM",type:e},e))});var o=r(39138),i=r(4522),c=r(53673);const l=({className:e,paymentService:t,iconList:r})=>{const l=(0,o.T)(),d=t===c.ob.XSOLLA;return(0,a.jsxs)("div",{className:(0,i.E)("purchase-footer-module__purchaseFooter--DZXkT",e),"data-testid":"purchase-footer",children:[(0,a.jsxs)("div",{className:"purchase-footer-module__label--zbkg7",children:[(0,a.jsx)(s.Z,{className:"purchase-footer-module__lockIcon--arp9D",type:"lock"}),(0,a.jsx)("span",{children:l("payments.secured_by",{params:{operator:d?"XSolla":"SSL"}})})]}),(0,a.jsx)(n,{list:r})]})};var d=r(49513),p=r(87363),u=r(77314),h=r(50337);const m=({paymentService:e})=>{const t=(e=>{const{platform:t,isSafari:r,lang:a}=(0,u.b)(),{isIOS:s}=(0,h.AK)(t);return(0,p.useMemo)(()=>{var t;return(t={isIOS:Boolean(s||r),lang:a},{[c.ob.XSOLLA]:["visa","master-card",t.isIOS?"apple-pay":"google-pay"],[c.ob.PSP]:["sbp","mir",t.lang===d.I.RU?"yandex-pay-ru":"yandex-pay-en"]})[e]},[s,r,a,e])})(e);return(0,a.jsx)(l,{iconList:t,paymentService:e})}},61631:(e,t,r)=>{r.d(t,{t:()=>u});var a=r(57627),s=r(36137),n=r(16482),o=r(1285),i=r(27936);const c="purchase-header-module__secondaryText--yE_ni";var l=r(39138),d=r(4522);const p=({className:e,balance:t})=>{const r=(0,l.T)();return(0,a.jsxs)("div",{className:(0,d.E)("purchase-header-module__purchaseHeader--uYN_N",e),"data-testid":"purchase-header",children:[(0,a.jsx)(i.Z,{type:n.rT.TEXT}),(0,a.jsxs)("div",{className:"purchase-header-module__balanceAmount--jvYfC","data-testid":"purchase-header-balance-amount",children:[(0,a.jsx)("span",{className:c,children:r("payments.you_have")}),(0,a.jsx)(o.Z,{amount:t,size:14,withIcon:!0}),(0,a.jsx)("span",{className:c,children:r("payments.currency",{number:t}).toLowerCase()})]})]})},u=()=>{const{balance:e}=(0,s.w)();return(0,a.jsx)(p,{balance:e})}},81391:(e,t,r)=>{r.d(t,{EP:()=>s});var a=r(99251);function s(e){const{hostname:t}=(0,a.e)();if(/\.yandex\.ru$/.test(t)){const r=new URL(e);r.hostname=t,e=r.toString()}return e}},2004:(e,t,r)=>{r.d(t,{Z:()=>h});var a=r(65751),s=r(48023),n=r(31369),o=Object.defineProperty,i=Object.defineProperties,c=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,d=Object.prototype.hasOwnProperty,p=Object.prototype.propertyIsEnumerable,u=(e,t,r)=>t in e?o(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;const h=(0,n.v)(function({pathsMapping:e},t,r){const n=a.parse(t.hash.slice(1));delete n.app;const o=new RegExp((0,s.k)(e));var h,m;r((h=((e,t)=>{for(var r in t||(t={}))d.call(t,r)&&u(e,r,t[r]);if(l)for(var r of l(t))p.call(t,r)&&u(e,r,t[r]);return e})({},t),m={pathname:t.pathname.replace(o,"")||"/",search:t.search,hash:a.stringify(n)},i(h,c(m))),{replace:!0,state:{}})})},48023:(e,t,r)=>{r.d(t,{I:()=>p,k:()=>c});var a=r(79403),s=r(67748),n=r(29513),o=r(5204),i=r(31369);const c=o.u`\\/(${a.EPath.APP}|preview)${n.gl}`,l=/^\/|\/$/g,d=/^(http|https):/,p=(0,i.v)(function({pathsMapping:e},{pathname:t,search:r},a="/"){const n=(0,s.parse)(r,{ignoreQueryPrefix:!0}),o=(0,s.stringify)(n,{addQueryPrefix:!0,filter:(e,t)=>"app"===e?void 0:t}),i=new RegExp(c(e)),p=t.replace(i,"").replace(l,""),u=a.replace(l,"");return d.test(u)?`${u}/${p}${o}`:`${u.length>0?`/${u}`:""}/${p}${o}`})},26433:(e,t,r)=>{r.d(t,{n:()=>n});var a=r(43774),s=r(36850);function n(e){const{doNotUseWindowOpen:t,href:r,target:n,windowOpenFeatures:o}=e;if((0,a.v_)({on:"open_game_inp.link_click"}))return(0,s.D)(function(e){const{doNotUseWindowOpen:t,href:r,target:a}=e;if(t)return()=>window.location.href=r;const s=document.createElement("a");return s.href=r,s.target=a,()=>{s.click(),s.remove()}}(e));if((0,a.v_)({on:"open_game_inp.window_open"})){const t=function(e){const{doNotUseWindowOpen:t,href:r,target:a,windowOpenFeatures:s}=e;if(t)return()=>window.location.href=r;const n=window.open(void 0,a,s);return n?()=>n.location.href=r:void 0}(e);if(t)return void window.setTimeout(t,0)}t?window.location.href=r:window.open(r,n,o)}},24062:(e,t,r)=>{function a(e,t){return Boolean("huawei_feed"===(null==e?void 0:e.utm_medium)||(null==t?void 0:t.includes("HuaweiBrowser")))}r.d(t,{V:()=>a})},36850:(e,t,r)=>{r.d(t,{D:()=>a});const a=e=>{if("undefined"==typeof window)throw new Error("Function must be called in browser env");window.requestAnimationFrame(()=>{window.setTimeout(e,0)})}},60918:(e,t,r)=>{r.d(t,{z:()=>ke});var a=r(57627),s=r(87363),n=r(38225),o=r(41145),i=r(36137),c=r(61631),l=r(84065),d=r(25678),p=r(53673),u=r(21377),h=r(50678),m=r(69729),f=r(29276),y=r(27987),v=r(63904),b=r.n(v),g=r(30928),w=r(19146),P=r(25963),k=r(68207),S=r(59962),I=r(87137),j=r(96533),O=r(55468),E=r(78825),_=r(81391),x=r(79092),C=r(37174),D=r(57847),R=r(2592),T=r(87125),N=r(99251),L=r(33376),A=r(50337),U=Object.defineProperty,$=Object.defineProperties,B=Object.getOwnPropertyDescriptors,M=Object.getOwnPropertySymbols,F=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable,W=Math.pow,H=(e,t,r)=>t in e?U(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,X=(e,t)=>{for(var r in t||(t={}))F.call(t,r)&&H(e,r,t[r]);if(M)for(var r of M(t))Z.call(t,r)&&H(e,r,t[r]);return e},z=(e,t)=>$(e,B(t)),Y=(e,t,r)=>(H(e,"symbol"!=typeof t?t+"":t,r),r);const J=(0,T.M$)("PurchaseIframeTemplate",T.XG.Dev),V=b().with("play-purchase-iframe"),G=e=>{let t=`${(0,N.e)().origin}${e}/sdk/payments/trust-redirect.html`;return t=(0,_.EP)(t),t},K=20*R.yR;class q extends h.P{constructor(e){super(e),Y(this,"isIOSVersionLessThan14",!(0,m.LR)(window.navigator.userAgent,m.jj,{major:14,minor:0,patch:0})),Y(this,"reachGoal"),Y(this,"removeIframeID",e=>{const t=this.state.iframeIDs;delete t[e],this.setState({iframeIDs:X({},t)})}),Y(this,"setIframeError",(e,t)=>{const r=this.state.iframeIDs[e];this.setState(a=>({iframeIDs:z(X({},a.iframeIDs),{[e]:z(X({},r),{error:t||"UNKNOWN"})})}))}),Y(this,"setIframeRef",e=>t=>{const r=this.state.iframeIDs[e];r&&!r.iframeElement&&this.setState(a=>({iframeIDs:z(X({},a.iframeIDs),{[e]:z(X({},r),{iframeElement:t})})}))}),this.state={iframeIDs:{},activeFrameID:""},this.reachGoal=(0,C.iF)(this)}componentDidMount(){window.addEventListener("message",this),this.create()}componentWillUnmount(){window.removeEventListener("message",this)}componentDidUpdate(e){const{amount:t,packId:r,price:a}=this.props;`${t}_${r}_${a}`!=`${e.amount}_${e.packId}_${e.price}`&&this.create()}handleEvent(e){if(!this.props.isValidEvent(e))return;const t=e.source,r=Object.values(this.state.iframeIDs).filter(e=>{var r;return(null==(r=e.iframeElement)?void 0:r.contentWindow)===t})[0],a=null==r?void 0:r.id;a?this.props.handleEvent(e,a,this):console.warn("Can not find promiseId for frame",Object.keys(this.state.iframeIDs),X({},this.state.iframeIDs))}setHeight(e,t){const r=this.state.iframeIDs[e];this.setState(a=>({iframeIDs:z(X({},a.iframeIDs),{[e]:z(X({},r),{height:t})})})),E.Z.post({type:"purchase-form",action:"on_resize"})}startPurchase(){E.Z.post({type:"purchase-form",action:"before_submit"})}afterPurchase(){E.Z.post({type:"purchase-form",action:"after_submit"})}setReadyState(e,t,r=0){const a=this.state.iframeIDs[e];a.setReadyStateTimeout&&window.clearTimeout(a.setReadyStateTimeout),a.setReadyStateTimeout=window.setTimeout(()=>{const r=this.state.iframeIDs[e];this.setState(a=>({iframeIDs:z(X({},a.iframeIDs),{[e]:z(X({},r),{isReady:t})})}))},r)}resolvePromise(e){const t=this.state.iframeIDs[e],{paymentService:r}=this.props;if(!t)return void Promise.reject(new Error("Can not find promise"));const{payCurrency:a,price:s,token:n}=t;if(t.inProgress)return void J(`resolve promise with ${n} already started`);const o=this.state.iframeIDs[e];if(this.setState(t=>({iframeIDs:z(X({},t.iframeIDs),{[e]:z(X({},o),{inProgress:!0})})})),J("resolve promise with token",n),!n){const r=new u.Z({code:"PAYMENT_FAILURE",message:"No trust token."});return this.setIframeError(t.id,null==r?void 0:r.code),void this.props.onReject(e,r)}r!==p.ob.XSOLLA&&this.reachGoal(L.Ji.PURCHASES_PURCHASE_SUCCESS,{amount:this.props.value,auth:Boolean(this.props.userData.uid),dialog_type:this.props.dialogType,order_price:this.props.price,appId:this.props.gameId,payment_system:this.props.provider}),this.setReadyState(e,!1),this.props.setUserBalanceFetchingStatus(),function(e,t){const r=R.WT;let a=0;return new Promise((s,n)=>{function o(){J("checkPurchaseStatus"),e.getPurchaseStatus(t).then(e=>{"success"===e.status?s(e):"failure"===e.status?n(new u.Z({code:"PAYMENT_FAILURE",message:"Failure payment status."})):i()}).catch(i)}function i(){a+=1;const e=r*Math.ceil(W(1.4,Math.ceil(a/10)));a<100?setTimeout(o,e):n(new u.Z({code:"PAYMENT_FAILURE",message:"Can not get payment status."}))}o()})}(this.props.api,n).then(t=>{J("checkPurchaseStatus resolve with response",JSON.stringify(t,null,"\t")),this.props.onResolve(e,t,{balanceDiff:Number(this.props.balanceDiff),price:this.state.iframeIDs[e].price}),t.status===p.mv.SUCCESS&&(0,D.i)({payCurrency:a,price:s},(0,f.u)()),this.removeIframeID(e)}).catch(t=>{this.setReadyState(e,!0),this.setIframeError(e,t.code),this.props.onReject(e,t),this.removeIframeID(e)})}rejectPromise(e,t){this.state.iframeIDs[e]?(this.setIframeError(e,null==t?void 0:t.code),this.props.onReject(e,t),this.removeIframeID(e)):Promise.reject(new Error("Can not find promise"))}create(){const{context:e}=this,{tld:t}=e,{amount:r,dialogType:a,email:s,packId:n,payCurrency:o,price:i,reason:c,paymentService:l}=this.props;J("BaseManager.create; packId, amount: ",n,r);const d=`${r}_${n}_${i}`,h=this.state.iframeIDs[d];if(h)return this.setState({activeFrameID:d}),void(Math.abs(Date.now()-h.timestamp)>=K&&(this.props.onReject(d,new u.Z({code:"PAYMENT_FAILURE",message:"Purchase frame was expired"})),this.removeIframeID(d)));if(this.setState(e=>({activeFrameID:d,iframeIDs:z(X({},e.iframeIDs),{[d]:{payCurrency:o,price:i,inProgress:!1,id:d,src:"about:blank",token:"",dataAuth:"",timestamp:Date.now()}})})),!n&&!r)return void console.error("No pack or amount.");const m=X(X({devParams:{developer_payload:JSON.stringify({"css-theme":this.props.darkTheme?"blackAndWhite":"transparentAndWhite",template:"checkout"})},clid:(0,x.X)(),lang:e.lang,payCurrency:o,paymentService:l,platform:"desktop",reason:c,redirect:G(this.context.baseUrl)},n?{productId:n}:{}),r?{amount:r}:{});if(l===p.ob.XSOLLA){const e=this.props.darkTheme?"default_dark":"default";m.paymentFormUiSettings={theme:e}}s&&(m.iGamesUserEmail=s),c===p.YC.PURCHASE&&this.props.gameId&&(m.appId=parseInt(this.props.gameId,10)),J("createPurchase",JSON.stringify(m,null,"\t")),this.props.api.createPurchase(m).then(e=>{var r,a;if(e&&e.url&&e.token){const s=new URL(e.url);if(l===p.ob.PSP&&!/^(.+\.){0,7}yandex\.(ru|by|kz|uk|uz|com|com\.tr)$/.test(s.host)){console.error("Bad Trust url",s.href);const r=P.A.includes(t)?t:"ru";s.host=`trust.yandex.${r}`,e.url=s.href}this.setState(t=>({iframeIDs:z(X({},t.iframeIDs),{[d]:{payCurrency:o,price:i,inProgress:!1,id:d,src:e.url,token:e.token,dataAuth:e.email?"false":"true",timestamp:Date.now()}})}));const{userData:n}=this.props;!e.email||n.uid&&n.email?E.Z.post({type:"purchase-form",action:"auth"}):(E.Z.post({type:"purchase-form",action:"lock_email",data:{email:e.email}}),null==(a=(r=this.props).onCreateIFrame)||a.call(r,e.email))}else this.setIframeError(d,"REQUEST_FAILURE"),this.props.onReject(d,new u.Z({code:"PAYMENT_FAILURE",message:"Can not get payment URL."})),this.removeIframeID(d)}).catch(e=>{this.reachGoal(L.Ji.PURCHASES_PURCHASE_PAYMENT_SYSTEM_LOAD_ERROR,{auth:Boolean(this.props.userData.uid),dialog_type:a,message:e.message,appId:this.props.gameId,payment_system:this.props.provider}),(0,O.f1)(e)?this.setIframeError(d,"UNAUTHORIZED"):this.setIframeError(d,"REQUEST_FAILURE"),this.props.onReject(d,e),this.removeIframeID(d)})}render(){const{iframeIDs:e,activeFrameID:t}=this.state,{isInvisible:r,fullScreen:s,getText:n,hasSmallSpinWithText:o}=this.props,i=Object.values(e),{isIOS:c}=(0,A.AK)(this.context.platform);return i.map(e=>{const i=e.isReady,l=e.id===t;return(0,a.jsxs)("div",{className:V({"state-ready":e.isReady,"full-screen":Boolean(s),hidden:!l||r,"ios-safari":this.context.isSafari&&c,"ios-less-14":c&&this.isIOSVersionLessThan14}),"data-testid":"payments-iframe",style:{height:e.height?`${e.height}px`:"auto"},children:[(0,a.jsx)("div",{className:V("holder"),children:(0,a.jsx)("iframe",z(X({className:V("frame")},l&&{"data-active-iframe":""}),{"data-auth":e.dataAuth,"data-token":e.token,ref:this.setIframeRef(e.id),sandbox:"allow-popups allow-forms allow-scripts allow-same-origin allow-top-navigation-by-user-activation",src:e.src}))}),!i&&(0,a.jsx)("div",{className:V("spin-wrapper"),children:o?(0,a.jsx)(y.y,{size:32,spinning:!0,text:e.setReadyStateTimeout?n("spin.wait"):n("spin.loading")}):(0,a.jsx)(y.y,{size:76,spinning:!0})})]},e.id)})}}const Q=(0,g.$j)(function(e){return{api:(0,S.Z)(e.apiData),darkTheme:(0,j.Up)(e),userData:e.userData,getText:e.getText,partnerEventsLogParams:(0,I.GA)(e)}},function(e){return(0,w.DE)({setUserBalanceFetchingStatus:k.k1},e)})(q);var ee=r(20966),te=r(97731),re=Object.defineProperty,ae=Object.defineProperties,se=Object.getOwnPropertyDescriptors,ne=Object.getOwnPropertySymbols,oe=Object.prototype.hasOwnProperty,ie=Object.prototype.propertyIsEnumerable,ce=(e,t,r)=>t in e?re(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;class le extends h.P{constructor(){var e;super(...arguments),ce(this,"symbol"!=typeof(e="handleEvent")?e+"":e,(e,t,r)=>{const{type:a,data:s={}}=e.data,{shouldWaitIframeButtonClick:n=!0,onStarted:o}=this.props,i=(e,a)=>{(0,ee.H)({block:te.W.TRUST,message:`[Payment Trust] ${a||e}`}),r.rejectPromise(t,new u.Z({code:"PAYMENT_FAILURE",message:e}))};switch(J(`Handle trust event '${a}'`,JSON.stringify(e.data,null,"\t")),a){case"on_resize":r.setHeight(t,e.data.data.height);break;case"form-submit":null==o||o();break;case"trust-challenge-end":if(n)return;s.success?r.resolvePromise(t):i("Payment fail.","Fail");break;case"before_submit":r.startPurchase();break;case"payment-loaded":r.setReadyState(t,!0,150);break;case"frame-error":i("Frame error.");break;case"payment-status":"success"===s.value&&r.resolvePromise(t);break;case"payment-complete":"success"===s.status&&r.resolvePromise(t);break;case"payment-check-failure":i("Payment check failure.","Check failure");break;case"payment-update-failure":i("Payment update failure.","Update failure");break;case"payment-fail":i("Payment fail.","Fail");break;case"payment-timeout":{const e=new u.Z({code:"PAYMENT_TIMEOUT",message:"Payment timeout."});r.rejectPromise(t,e);break}case"3ds-status":"3ds-success"===s?r.resolvePromise(t):"3ds-failure"===s&&i("Payment 3ds failure.","3ds failure");break;case"redirect-callback":r.resolvePromise(t);break;case"sbp-bank-selected":window.open(s,"_self")}})}isValidEvent(e){return t=e.origin,!!/^https:\/\/(.+\.){0,7}yandex\.(ru|by|kz|uk|uz|com|com\.tr)(:\d+)?$/.test(t)&&!(!e.data||"YandexTrustPaymentForm"!==e.data.source);var t}render(){const{props:e}=this;return(0,a.jsx)(Q,((e,t)=>ae(e,se(t)))(((e,t)=>{for(var r in t||(t={}))oe.call(t,r)&&ce(e,r,t[r]);if(ne)for(var r of ne(t))ie.call(t,r)&&ce(e,r,t[r]);return e})({},e),{handleEvent:this.handleEvent,isValidEvent:this.isValidEvent,provider:p.qY.TRUST}))}}var de=r(3891),pe=Object.defineProperty,ue=Object.defineProperties,he=Object.getOwnPropertyDescriptors,me=Object.getOwnPropertySymbols,fe=Object.prototype.hasOwnProperty,ye=Object.prototype.propertyIsEnumerable,ve=(e,t,r)=>t in e?pe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,be=(e,t,r)=>(ve(e,"symbol"!=typeof t?t+"":t,r),r);class ge extends h.P{constructor(){super(...arguments),be(this,"resolveTimeoutId"),be(this,"handleEvent",(e,t,r)=>{let a;try{a=JSON.parse(e.data)}catch(t){return void(0,ee.H)({block:te.W.XSOLLA,message:"[Payment Xsolla] Error while attempting to parse Xsolla data",additional:{data:e.data}},t)}switch(null==a?void 0:a.action){case"resize":return void r.setHeight(t,a.height);case"finish":const e=new u.Z({code:"PAYMENT_FAILURE",message:"Payment cancelled."});return(0,ee.H)({block:te.W.XSOLLA,message:"[Payment Xsolla] Cancelled"}),void r.rejectPromise(t,e)}switch(null==a?void 0:a.command){case"open-paystation":return void r.setReadyState(t,!0,150);case"resize":return void r.setHeight(t,a.data.dimensions.height);case"change-status":switch(a.data.value){case"done":return void(this.resolveTimeoutId=window.setTimeout(()=>{delete this.resolveTimeoutId,r.resolvePromise(t)},2e3));case"processing":return void r.startPurchase();case"canceled":return(0,ee.H)({block:te.W.XSOLLA,message:"[Payment Xsolla] Declined"}),void r.afterPurchase()}}})}isValidEvent(e){return(0,de.W)(e.origin)}render(){const{props:e}=this;return(0,a.jsx)(Q,((e,t)=>ue(e,he(t)))(((e,t)=>{for(var r in t||(t={}))fe.call(t,r)&&ve(e,r,t[r]);if(me)for(var r of me(t))ye.call(t,r)&&ve(e,r,t[r]);return e})({},e),{handleEvent:this.handleEvent,isValidEvent:this.isValidEvent,provider:p.qY.XSOLLA}))}}var we=r(29789),Pe=r(25576);const ke=({children:e})=>{const{selectedProduct:t,buyPlatformProduct:r,failedToBuyPlatformProduct:u}=(0,we.O)(),{balance:h}=(0,i.O)(),m=(0,n.C)(e=>e.user.payCurrency),f=(0,d.u)()===p.ob.PSP?le:ge,y=(0,d.u)(),v=(0,s.useCallback)(()=>{u()},[u]),b=(0,s.useCallback)(()=>{r()},[r]),g=(0,s.useMemo)(()=>{if(t)return Math.max(t.price-h,Pe.q.minPurchaseAmount)},[t,h]);return(0,a.jsxs)("div",{className:"purchase-layout-module__purchaseLayout--Os1c0","data-testid":"disable-adv-purchase-layout",children:[(0,a.jsxs)("div",{className:"purchase-layout-module__purchaseInfo--kZWwl",children:[(0,a.jsxs)("div",{className:"purchase-layout-module__purchaseProductWrapper--KUCgM",children:[(0,a.jsx)(c.t,{}),e]}),(0,a.jsx)(l.w,{paymentService:y})]}),t&&(0,a.jsx)("div",{className:"purchase-layout-module__paymentsIframeWrapper--aX2bN",children:(0,a.jsx)(f,{amount:g,dialogType:o.Z.PURCHASE,email:"",fullScreen:!0,hasSmallSpinWithText:!0,isInvisible:!1,packId:void 0,payCurrency:m,paymentService:y,price:100,reason:p.YC.PLAY,shouldWaitIframeButtonClick:!1,onReject:v,onResolve:b})})]})}},57847:(e,t,r)=>{r.d(t,{i:()=>l});var a=r(20966),s=r(29513),n=r(87125),o=r(97731),i=(e,t,r)=>new Promise((a,s)=>{var n=e=>{try{i(r.next(e))}catch(e){s(e)}},o=e=>{try{i(r.throw(e))}catch(e){s(e)}},i=e=>e.done?a(e.value):Promise.resolve(e.value).then(n,o);i((r=r.apply(e,t)).next())});const c=(0,n.M$)("AppMetrica",n.XG.Dev);function l(e,t){return i(this,arguments,function*({payCurrency:e,price:t},r){if("function"==typeof(null==r?void 0:r.reportRevenue)){const n=parseFloat(t.toFixed(2));try{yield r.reportRevenue({revenue:n,currency:e,adjustToken:s.lG}),c("sendReportRevenueOnSuccess",{revenue:n,currency:e,adjustToken:s.lG})}catch(e){(0,a.H)({block:o.W.PAYMENT,message:`reportRevenue error: ${e.message}`},e)}}})}}}]);
//# sourceMappingURL=https://s3.mdst.yandex.net/games/source-maps/_/build/client/game/desktop/yandex/DisableAdv.component.async.742f909e8bfe0254033a.js.map